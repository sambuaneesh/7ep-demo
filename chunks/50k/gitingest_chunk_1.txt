Directory structure:
└── 7ep-demo/
    ├── README.md
    ├── DIRECTORY_README.txt
    ├── gradle.properties
    ├── gradlew
    ├── gradlew.bat
    ├── LICENSE
    ├── Pipfile
    ├── desktop_app/
    │   ├── README.txt
    │   ├── gradlew
    │   ├── gradlew.bat
    │   ├── gradle/
    │   │   └── wrapper/
    │   │       └── gradle-wrapper.properties
    │   └── src/
    │       ├── main/
    │       │   ├── java/
    │       │   │   └── com/
    │       │   │       └── coveros/
    │       │   │           └── training/
    │       │   │               └── autoinsurance/
    │       │   │                   ├── AutoInsuranceAction.java
    │       │   │                   ├── AutoInsuranceProcessor.java
    │       │   │                   ├── AutoInsuranceScriptServer.java
    │       │   │                   ├── AutoInsuranceUI.java
    │       │   │                   ├── InvalidClaimsException.java
    │       │   │                   └── WarningLetterEnum.java
    │       │   └── resources/
    │       │       └── log4j2.xml
    │       └── test/
    │           └── java/
    │               └── com/
    │                   └── coveros/
    │                       └── training/
    │                           └── autoinsurance/
    │                               ├── AutoInsuranceActionTests.java
    │                               ├── AutoInsuranceProcessorTests.java
    │                               ├── AutoInsuranceScriptClient.java
    │                               ├── DesktopTester.java
    │                               ├── DesktopUiTests.java
    │                               └── ExecutionDataClient.java
    ├── docs/
    │   ├── README.txt
    │   ├── coveros_text.txt
    │   ├── api_testing/
    │   │   ├── README.txt
    │   │   ├── api_testing_with_curl.txt
    │   │   ├── api_testing_with_soapui.txt
    │   │   ├── soapui_demo_tests.xml
    │   │   └── tester.postman_collection.json
    │   ├── ci_and_cd/
    │   │   ├── README.txt
    │   │   ├── ci_and_cd_for_localhost.txt
    │   │   ├── install_docker_centos.txt
    │   │   ├── jenkins_box_guide.txt
    │   │   ├── ssl.txt
    │   │   ├── ui_test_box.txt
    │   │   └── virtualbox_networking.txt
    │   ├── dev_notes/
    │   │   ├── README.txt
    │   │   ├── architecture.txt
    │   │   ├── monitoring_tomcat.txt
    │   │   ├── pre-push
    │   │   └── README_db.txt
    │   ├── performance_testing/
    │   │   ├── README.txt
    │   │   └── perf_testing_with_jmeter.txt
    │   ├── security_testing/
    │   │   ├── README.txt
    │   │   └── zap_proxy_security_scanning.txt
    │   └── ui_testing/
    │       ├── README.txt
    │       ├── desktop_automation.txt
    │       ├── python_selenium_cheat_sheet.txt
    │       ├── python_selenium_walkthrough.txt
    │       ├── README_python.txt
    │       └── running selenium_grid.txt
    ├── gradle/
    │   └── wrapper/
    │       └── gradle-wrapper.properties
    ├── jenkins/
    │   └── Jenkinsfile
    └── src/
        ├── README.txt
        ├── api_tests/
        │   ├── README.txt
        │   ├── pytest.ini
        │   └── test_api.py
        ├── bdd_test/
        │   ├── README.txt
        │   ├── java/
        │   │   └── com/
        │   │       └── coveros/
        │   │           └── training/
        │   │               ├── authentication/
        │   │               │   ├── LoginStepDefs.java
        │   │               │   └── RegistrationStepDefs.java
        │   │               ├── cartesianproduct/
        │   │               │   └── CartesianProductStepDefs.java
        │   │               ├── expenses/
        │   │               │   └── AlcoholStepDefs.java
        │   │               ├── library/
        │   │               │   ├── AddDeleteListSearchBooksAndBorrowersStepDefs.java
        │   │               │   └── BookCheckOutStepDefs.java
        │   │               └── math/
        │   │                   ├── AckermannStepDefs.java
        │   │                   ├── FibonacciStepDefs.java
        │   │                   └── MathStepDefs.java
        │   └── resources/
        │       ├── authentication/
        │       │   ├── login_user.feature
        │       │   └── register_user.feature
        │       ├── cartesianproduct/
        │       │   └── cartesianproduct.feature
        │       ├── expenses/
        │       │   └── alcohol.feature
        │       ├── library/
        │       │   ├── add_and_delete_books.feature
        │       │   ├── add_and_delete_borrowers.feature
        │       │   ├── check_out_a_book.feature
        │       │   ├── list_and_search_books.feature
        │       │   └── list_and_search_borrowers.feature
        │       └── math/
        │           ├── ackerman.feature
        │           ├── Fibonacci.feature
        │           └── math.feature
        ├── integration_test/
        │   ├── java/
        │   │   └── com/
        │   │       └── coveros/
        │   │           └── training/
        │   │               └── persistence/
        │   │                   └── PersistenceLayerTests.java
        │   └── resources/
        │       └── db_sample_files/
        │           ├── README.txt
        │           ├── v2_empty_schema.sql
        │           ├── v2_one_book_one_borrower.sql
        │           ├── v2_one_loan.sql
        │           ├── v2_one_user.sql
        │           └── v2_three_books_three_borrowers.sql
        ├── main/
        │   ├── java/
        │   │   └── com/
        │   │       └── coveros/
        │   │           └── training/
        │   │               ├── README.txt
        │   │               ├── authentication/
        │   │               │   ├── LoginServlet.java
        │   │               │   ├── LoginUtils.java
        │   │               │   ├── package-info.java
        │   │               │   ├── RegisterServlet.java
        │   │               │   ├── RegistrationUtils.java
        │   │               │   └── domainobjects/
        │   │               │       ├── package-info.java
        │   │               │       ├── PasswordResult.java
        │   │               │       ├── PasswordResultEnums.java
        │   │               │       ├── RegistrationResult.java
        │   │               │       ├── RegistrationStatusEnums.java
        │   │               │       └── User.java
        │   │               ├── cartesianproduct/
        │   │               │   ├── CartesianProduct.java
        │   │               │   └── package-info.java
        │   │               ├── expenses/
        │   │               │   ├── AlcoholCalculator.java
        │   │               │   ├── AlcoholResult.java
        │   │               │   ├── DinnerPrices.java
        │   │               │   └── package-info.java
        │   │               ├── helpers/
        │   │               │   ├── AssertionException.java
        │   │               │   ├── CheckUtils.java
        │   │               │   ├── package-info.java
        │   │               │   ├── ServletUtils.java
        │   │               │   └── StringUtils.java
        │   │               ├── library/
        │   │               │   ├── LibraryBookListAvailableServlet.java
        │   │               │   ├── LibraryBookListSearchServlet.java
        │   │               │   ├── LibraryBorrowerListSearchServlet.java
        │   │               │   ├── LibraryLendServlet.java
        │   │               │   ├── LibraryRegisterBookServlet.java
        │   │               │   ├── LibraryRegisterBorrowerServlet.java
        │   │               │   ├── LibraryUtils.java
        │   │               │   ├── package-info.java
        │   │               │   └── domainobjects/
        │   │               │       ├── Book.java
        │   │               │       ├── Borrower.java
        │   │               │       ├── LibraryActionResults.java
        │   │               │       ├── Loan.java
        │   │               │       └── package-info.java
        │   │               ├── mathematics/
        │   │               │   ├── Ackermann.java
        │   │               │   ├── AckermannIterative.java
        │   │               │   ├── AckServlet.java
        │   │               │   ├── Calculator.java
        │   │               │   ├── Fibonacci.java
        │   │               │   ├── FibonacciIterative.java
        │   │               │   ├── FibServlet.java
        │   │               │   ├── FunctionalField.java
        │   │               │   ├── MathServlet.java
        │   │               │   ├── package-info.java
        │   │               │   └── TailRecursive.java
        │   │               ├── persistence/
        │   │               │   ├── DbServlet.java
        │   │               │   ├── EmptyDataSource.java
        │   │               │   ├── IPersistenceLayer.java
        │   │               │   ├── NotImplementedException.java
        │   │               │   ├── package-info.java
        │   │               │   ├── ParameterObject.java
        │   │               │   ├── PersistenceLayer.java
        │   │               │   ├── SqlData.java
        │   │               │   └── SqlRuntimeException.java
        │   │               └── tomcat/
        │   │                   ├── package-info.java
        │   │                   └── WebAppListener.java
        │   ├── javadoc/
        │   │   └── overview.html
        │   ├── resources/
        │   │   ├── README.txt
        │   │   ├── log4j2.xml
        │   │   └── db/
        │   │       ├── README.txt
        │   │       └── migration/
        │   │           ├── V1__Create_person_table.sql
        │   │           └── V2__Rest_of_tables_for_auth_and_library.sql
        │   └── webapp/
        │       ├── catalog.css
        │       ├── catalog.js
        │       ├── dbhelp.html
        │       ├── endpointcatalog.html
        │       ├── index.html
        │       ├── library.html
        │       ├── library.js
        │       ├── main.css
        │       ├── restfulresult.jsp
        │       ├── result.jsp
        │       └── WEB-INF/
        │           └── web.xml
        ├── selenified_tests/
        │   ├── java/
        │   │   └── com/
        │   │       └── coveros/
        │   │           └── training/
        │   │               └── selenified/
        │   │                   └── SelenifiedSample.java
        │   └── resources/
        │       └── selenified.properties
        ├── test/
        │   └── java/
        │       └── com/
        │           └── coveros/
        │               └── training/
        │                   ├── authentication/
        │                   │   ├── LoginServletTests.java
        │                   │   ├── LoginUtilsTests.java
        │                   │   ├── RegisterServletTests.java
        │                   │   ├── RegistrationUtilsTests.java
        │                   │   └── domainobjects/
        │                   │       ├── PasswordResultTests.java
        │                   │       ├── RegistrationResultTests.java
        │                   │       └── UserTests.java
        │                   ├── helpers/
        │                   │   ├── CheckUtilsTests.java
        │                   │   ├── DateUtils.java
        │                   │   ├── DateUtilsTests.java
        │                   │   └── StringUtilsTests.java
        │                   ├── library/
        │                   │   ├── LendingTests.java
        │                   │   ├── LibraryBookListAvailableServletTests.java
        │                   │   ├── LibraryBookListSearchServletTests.java
        │                   │   ├── LibraryBorrowerListSearchServletTests.java
        │                   │   ├── LibraryLendServletTests.java
        │                   │   ├── LibraryRegisterBookServletTests.java
        │                   │   ├── LibraryRegisterBorrowerServletTests.java
        │                   │   ├── LibraryUtilsTests.java
        │                   │   └── domainobjects/
        │                   │       ├── BookTests.java
        │                   │       ├── BorrowerTests.java
        │                   │       └── LoanTests.java
        │                   ├── mathematics/
        │                   │   ├── AckermannIterativeParameterizedTests.java
        │                   │   ├── AckermannParameterizedTests.java
        │                   │   ├── AckServletTests.java
        │                   │   ├── CalculatorTests.java
        │                   │   ├── FibonacciParameterizedTests.java
        │                   │   ├── FibonacciTests.java
        │                   │   ├── FibServletTests.java
        │                   │   └── MathServletTests.java
        │                   ├── persistence/
        │                   │   ├── DbServletTests.java
        │                   │   ├── EmptyDataSourceTests.java
        │                   │   ├── ParameterObjectTests.java
        │                   │   └── SqlDataTests.java
        │                   └── tomcat/
        │                       └── WebAppListenerTests.java
        └── ui_tests/
            ├── README.txt
            ├── behave/
            │   ├── README.txt
            │   ├── setup.cfg
            │   └── features/
            │       ├── authentication_ui.feature
            │       ├── environment.py
            │       ├── librarian_ui.feature
            │       └── steps/
            │           ├── ackermannStepDefs.py
            │           ├── authenticationStepDefs.py
            │           ├── fibonacciStepDefs.py
            │           └── librarianStepDefs.py
            ├── cs/
            │   ├── README.txt
            │   └── testproject/
            │       ├── testproject.csproj
            │       ├── testproject.sln
            │       └── UiTest.cs
            ├── java/
            │   ├── README.txt
            │   ├── gradle.properties
            │   ├── gradlew
            │   ├── gradlew.bat
            │   ├── gradle/
            │   │   └── wrapper/
            │   │       └── gradle-wrapper.properties
            │   └── src/
            │       ├── main/
            │       │   └── resources/
            │       │       └── log4j2.xml
            │       └── test/
            │           └── java/
            │               └── com/
            │                   └── coveros/
            │                       └── training/
            │                           ├── ApiCalls.java
            │                           ├── HtmlUnitTests.java
            │                           └── SeleniumTests.java
            ├── js/
            │   ├── README.txt
            │   ├── package.json
            │   └── test/
            │       └── test.spec.js
            └── python/
                ├── README.txt
                ├── basic_test.py
                └── Pipfile

================================================
FILE: README.md
================================================
## Demo - demonstrates an application and tests

This is an application by [Coveros](https://www.coveros.com/) to demonstrate good
software practices.  As we say in agile... _Working software over comprehensive 
documentation_ ... but that doesn't mean we can't have pretty good documentation too. 

#### Quick Start:

* Install [Java](https://www.java.com/en/download/) if you don't already have it.
* Clone or [download](https://github.com/7ep/demo/archive/master.zip) this repo.  (if you download, unzip the file to a directory.)
* On the command line in the top directory of this repo, run `gradlew apprun`
* Visit the application with your browser at http://localhost:8080/demo

#### Summary:

Demo consists of a simple web application and tests.  Its goal is to provide 
an environment suitable for demonstration and practice in valuable development
techniques.  Some of the techniques exemplified are:
* [Unit](https://github.com/7ep/demo/blob/master/src/test/java/com/coveros/training/authentication/RegistrationUtilsTests.java) [tests](https://github.com/7ep/demo/blob/master/src/test/java/com/coveros/training/library/LibraryUtilsTests.java) developed by [TDD](https://en.wikipedia.org/wiki/Test-driven_development) using [Junit](https://junit.org/junit5/) as a driver and [Mockito](https://site.mockito.org/) for mocks, with coverage reports.
* [UI tests](https://github.com/7ep/demo/blob/master/src/ui_tests/behave/features/librarian_ui.feature) using [multiple frameworks](https://github.com/7ep/demo/tree/master/src/ui_tests)
* [BDD](https://en.wikipedia.org/wiki/Behavior-driven_development) [tests](https://github.com/7ep/demo/blob/master/src/bdd_test/resources/library/check_out_a_book.feature) using gherkin
  * [Cucumber](https://docs.cucumber.io/) tests, with reports
  * [Behave](https://behave.readthedocs.io/en/latest/) UI tests that use [Selenium](https://www.selenium.dev/) web driver.
* [Integration tests](https://github.com/7ep/demo/blob/master/src/integration_test/java/com/coveros/training/persistence/PersistenceLayerTests.java) that test the [H2 database](https://www.h2database.com/html/main.html)
* [Database versioning](https://github.com/7ep/demo/blob/master/src/main/resources/db/migration/V2__Rest_of_tables_for_auth_and_library.sql), with [Flyway](https://flywaydb.org/)
* Security analysis using [DependencyCheck](https://www.owasp.org/index.php/OWASP_Dependency_Check)
* Hot-swap code with [Gretty](https://github.com/gretty-gradle-plugin/gretty)
* Enhanced type system using [Checker Framework](https://checkerframework.org/)
* See its [architecture](https://github.com/7ep/demo/blob/master/docs/dev_notes/architecture.txt)


Its essential goals:
* Just works, any platform.
* As simple as possible
* Minimal system requirements
* Fast and easy to install and to run
* High test coverage
* Multiple business domains
* Easy to maintain and improve
* Well documented
* High performance
* Illustrates maximum number of techniques
* Easy to get up to speed

#### Table of contents:
1. [Optional dependencies](#optional-dependencies)
1. [Chromedriver installation notes](#chromedriver-installation-notes)
1. [Python installation notes](#python-installation-notes)
1. [To build and run tests](#to-build-and-run-tests)
1. [To run the application](#to-run-the-web-application)
1. [To run API and UI tests](#to-run-api-and-ui-tests)
1. [Summary of relevant Gradle commands](#summary-of-relevant-gradle-commands)
1. [The whole shebang - CI/CD pipeline](#the-whole-shebang---a-cicd-pipeline)

###### Optional Dependencies
If you want API testing and Selenium testing, you will need
to visit these links and download / install the applications found there.
* [Python](https://www.python.org/downloads/)
* [Chromedriver](http://chromedriver.chromium.org/downloads)
* [Chrome internet browser](https://www.google.com/chrome/)

---

#### Chromedriver installation notes
make sure that the [Chromedriver](https://chromedriver.chromium.org/) executable is installed in one of the directories that is 
on your path.  To see your path, type the following in a command line: 

on Windows:

    echo %PATH%  
    
On Mac/Linux:

    echo $PATH
    
If you run the command, `chromedriver` on the command  line, you should get a result similar to this:

    Starting ChromeDriver ...
        
#### Python installation notes
Python can be downloaded [here](https://www.python.org/downloads/)

To run API tests and Selenium tests, an easy way to handle its 
dependencies is to use *pipenv*.  To get this installed, first download
[get-pip.py](https://bootstrap.pypa.io/get-pip.py), and run the following on the command line:

    python get-pip.py
    
Then,

    pip install pipenv
   
And in the demo directory,
    
    pipenv install   
   
#### To build and run tests:
On the command line, run the following:

On Mac/Linux

    ./gradlew check

On Windows

    gradlew check

#### To run the web application:
On the command line, run the following:

On Mac/Linux

    ./gradlew apprun

On Windows

    gradlew apprun
    
Then, head to http://localhost:8080/demo    
    

#### To run API and UI tests:
Note: The app has to be [already running](#to-run-the-web-application) for these tests to pass, and you _need_
to have installed [Python] and [Chromedriver].

In a new terminal, separate from the one where the server is running, run the following:

On Mac/Linux

    ./gradlew runAllTests

On Windows

    gradlew runAllTests    
    
#### Summary of relevant Gradle commands
* gradlew coveros - show a cheat sheet of commands for Demo
* gradlew apprun - runs the application
* gradlew check - runs all tests possible with only dependency being Java 8.  No need for app to be running.
* gradlew runAllTests - runs the whole set of tests**  
* gradlew clean - cleans build products and installs pre-push hook. (see the file in this directory, pre-push)
* gradlew runBehaveTests - runs the UI tests**
* gradlew runApiTests - runs the API tests**
* gradlew generateCucumberReport - runs cucumber and creates a nice-looking HTML report
* gradlew pitest - runs mutation testing (see http://pitest.org/)
* gradlew dependencyCheckAnalyze - analyzes security reports for the dependencies of 
  this project.  See https://www.owasp.org/index.php/OWASP_Dependency_Check
* gradlew sonarqube - runs static analysis using SonarQube.  Sonarqube must be running - check http://localhost:9000
* gradlew integrate - runs the database integration tests
* gradlew startH2Console - Starts a console to examine the H2 database file.  (user and
  password are empty, URL to use is jdbc:h2:./build/db/training)
* gradlew <task 1>...<task N> taskTree - a utility that will show the task tree for a particular task


  ** Requires the app to be running 
     (usually in another terminal) and all optional dependencies installed.
    
#### The whole shebang - a CI/CD pipeline

Details on building out a CI/CD pipeline are found in the "docs/ci_and_cd" directory.
For example, to set it all up on a [local Windows box](https://raw.githubusercontent.com/7ep/demo/master/docs/ci_and_cd/ci_and_cd_for_localhost.txt) 

###### Features of the pipeline:
* A fully functioning and documented demonstration CI/CD pipeline using Jenkins.
* BDD tests run with a report generated
* Static analysis quality-gating using SonarQube
* UI tests running on Chrome
* Performance testing with Jmeter
* Security analysis with OWASP's "DependencyCheck"
* Complex commands wrapped simply using Gradle
* Mutation testing with Pitest
* Javadocs built



---

## Screenshots:
![Jenkins pipeline](https://c2.staticflickr.com/8/7889/33202009658_11422b7f20_b.jpg)

![Zap attach proxy](https://c2.staticflickr.com/8/7905/33202009438_8f367e20ec_o.png)

![SonarQube analysis](https://c2.staticflickr.com/8/7823/33202009548_e678128200_b.jpg)

![Running performance tests](https://c2.staticflickr.com/8/7854/47077017751_7e045f68dd_b.jpg)



================================================
FILE: DIRECTORY_README.txt
================================================
Directories and files at the top level:

Directories
-----------
desktop_app  :   a project to demonstrate testing of desktop apps
docs         :   documents related to this application
gradle       :   necessary wrapper files and some capabilities related to certain tests
jenkins      :   holds the Jenkinsfile for CI/CD
src          :   has the application's source code and all test code

Files
-----
.gitattributes          :    certain configuration settings for Git
.gitignore              :    files and directories we don't want stored in Git
build.gradle            :    the primary Gradle configuration file
gradlew / gradlew.bat   :    runs a "wrapper" version of gradle so that
                             it is not necessary to have gradle installed to run it
LICENSE                 :    the license for the application
Pipfile, Pipefile.lock  :    used by Pipenv to list needed dependencies
DIRECTORY_README.txt    :    this file
README.md               :    a description of the project and how to use it


================================================
FILE: gradle.properties
================================================
projectname=Demo
Description=A demonstration of a web application with CI/CD
version=1.0.0
org.gradle.daemon=true
#
#If you want to specify the path to chromedriver.
#chromedriver.path=C:/Users/foo/Downloads/chromedriver_win32/chromedriver.exe
#chromedriver.path=/home/foo/Downloads/chromedriver_linux/chromedriver

# if you want to debug gradle, this will open a port on 5006 when the
# daemon is running.
#org.gradle.jvmargs=-XX:MaxPermSize=4g -XX:+HeapDumpOnOutOfMemoryError -Xmx4g -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5006

#no need for colorful output and progress bars.  plain will do.
org.gradle.console=plain
org.gradle.workers.max=1

# Setting the memory config explicitly
org.gradle.jvmargs=-Xmx1g -XX:MaxMetaspaceSize=1024m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8



================================================
FILE: gradlew
================================================
#!/usr/bin/env sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

##############################################################################
##
##  Gradle start up script for UN*X
##
##############################################################################

# Attempt to set APP_HOME
# Resolve links: $0 may be a link
PRG="$0"
# Need this for relative symlinks.
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
        PRG="$link"
    else
        PRG=`dirname "$PRG"`"/$link"
    fi
done
SAVED="`pwd`"
cd "`dirname \"$PRG\"`/" >/dev/null
APP_HOME="`pwd -P`"
cd "$SAVED" >/dev/null

APP_NAME="Gradle"
APP_BASE_NAME=`basename "$0"`

# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD="maximum"

warn () {
    echo "$*"
}

die () {
    echo
    echo "$*"
    echo
    exit 1
}

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "`uname`" in
  CYGWIN* )
    cygwin=true
    ;;
  Darwin* )
    darwin=true
    ;;
  MINGW* )
    msys=true
    ;;
  NONSTOP* )
    nonstop=true
    ;;
esac

CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD="$JAVA_HOME/jre/sh/java"
    else
        JAVACMD="$JAVA_HOME/bin/java"
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD="java"
    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
fi

# Increase the maximum file descriptors if we can.
if [ "$cygwin" = "false" -a "$darwin" = "false" -a "$nonstop" = "false" ] ; then
    MAX_FD_LIMIT=`ulimit -H -n`
    if [ $? -eq 0 ] ; then
        if [ "$MAX_FD" = "maximum" -o "$MAX_FD" = "max" ] ; then
            MAX_FD="$MAX_FD_LIMIT"
        fi
        ulimit -n $MAX_FD
        if [ $? -ne 0 ] ; then
            warn "Could not set maximum file descriptor limit: $MAX_FD"
        fi
    else
        warn "Could not query maximum file descriptor limit: $MAX_FD_LIMIT"
    fi
fi

# For Darwin, add options to specify how the application appears in the dock
if $darwin; then
    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
fi

# For Cygwin or MSYS, switch paths to Windows format before running java
if [ "$cygwin" = "true" -o "$msys" = "true" ] ; then
    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`

    JAVACMD=`cygpath --unix "$JAVACMD"`

    # We build the pattern for arguments to be converted via cygpath
    ROOTDIRSRAW=`find -L / -maxdepth 1 -mindepth 1 -type d 2>/dev/null`
    SEP=""
    for dir in $ROOTDIRSRAW ; do
        ROOTDIRS="$ROOTDIRS$SEP$dir"
        SEP="|"
    done
    OURCYGPATTERN="(^($ROOTDIRS))"
    # Add a user-defined pattern to the cygpath arguments
    if [ "$GRADLE_CYGPATTERN" != "" ] ; then
        OURCYGPATTERN="$OURCYGPATTERN|($GRADLE_CYGPATTERN)"
    fi
    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    i=0
    for arg in "$@" ; do
        CHECK=`echo "$arg"|egrep -c "$OURCYGPATTERN" -`
        CHECK2=`echo "$arg"|egrep -c "^-"`                                 ### Determine if an option

        if [ $CHECK -ne 0 ] && [ $CHECK2 -eq 0 ] ; then                    ### Added a condition
            eval `echo args$i`=`cygpath --path --ignore --mixed "$arg"`
        else
            eval `echo args$i`="\"$arg\""
        fi
        i=`expr $i + 1`
    done
    case $i in
        0) set -- ;;
        1) set -- "$args0" ;;
        2) set -- "$args0" "$args1" ;;
        3) set -- "$args0" "$args1" "$args2" ;;
        4) set -- "$args0" "$args1" "$args2" "$args3" ;;
        5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
        6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
        7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
        8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
        9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
    esac
fi

# Escape application args
save () {
    for i do printf %s\\n "$i" | sed "s/'/'\\\\''/g;1s/^/'/;\$s/\$/' \\\\/" ; done
    echo " "
}
APP_ARGS=`save "$@"`

# Collect all arguments for the java command, following the shell quoting and substitution rules
eval set -- $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS "\"-Dorg.gradle.appname=$APP_BASE_NAME\"" -classpath "\"$CLASSPATH\"" org.gradle.wrapper.GradleWrapperMain "$APP_ARGS"

exec "$JAVACMD" "$@"



================================================
FILE: gradlew.bat
================================================
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem

@if "%DEBUG%" == "" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%" == "" set DIRNAME=.
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if "%ERRORLEVEL%" == "0" goto execute

echo.
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo.
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*

:end
@rem End local scope for the variables with windows NT shell
if "%ERRORLEVEL%"=="0" goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
exit /b 1

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega



================================================
FILE: LICENSE
================================================
MIT License

Copyright (c) 2019 Byron Katz, Coveros Inc.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.


================================================
FILE: Pipfile
================================================
[[source]]
name = "pypi"
url = "https://pypi.org/simple"
verify_ssl = true

[dev-packages]

[packages]
requests = "*"
behave = "*"
pyhamcrest = "*"
selenium = "*"
pytest = "*"
behave2cucumber = "*"



================================================
FILE: desktop_app/README.txt
================================================
This is a desktop application to demonstrate testing.

To see the application, run: gradlew startui

To run the tests: gradlew test

Review the reports at build/reports/jacoco


================================================
FILE: desktop_app/gradlew
================================================
#!/usr/bin/env sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

##############################################################################
##
##  Gradle start up script for UN*X
##
##############################################################################

# Attempt to set APP_HOME
# Resolve links: $0 may be a link
PRG="$0"
# Need this for relative symlinks.
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
        PRG="$link"
    else
        PRG=`dirname "$PRG"`"/$link"
    fi
done
SAVED="`pwd`"
cd "`dirname \"$PRG\"`/" >/dev/null
APP_HOME="`pwd -P`"
cd "$SAVED" >/dev/null

APP_NAME="Gradle"
APP_BASE_NAME=`basename "$0"`

# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD="maximum"

warn () {
    echo "$*"
}

die () {
    echo
    echo "$*"
    echo
    exit 1
}

# OS specific support (must be 'true' or 'false').
cygwin=false
msys=false
darwin=false
nonstop=false
case "`uname`" in
  CYGWIN* )
    cygwin=true
    ;;
  Darwin* )
    darwin=true
    ;;
  MINGW* )
    msys=true
    ;;
  NONSTOP* )
    nonstop=true
    ;;
esac

CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD="$JAVA_HOME/jre/sh/java"
    else
        JAVACMD="$JAVA_HOME/bin/java"
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD="java"
    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
fi

# Increase the maximum file descriptors if we can.
if [ "$cygwin" = "false" -a "$darwin" = "false" -a "$nonstop" = "false" ] ; then
    MAX_FD_LIMIT=`ulimit -H -n`
    if [ $? -eq 0 ] ; then
        if [ "$MAX_FD" = "maximum" -o "$MAX_FD" = "max" ] ; then
            MAX_FD="$MAX_FD_LIMIT"
        fi
        ulimit -n $MAX_FD
        if [ $? -ne 0 ] ; then
            warn "Could not set maximum file descriptor limit: $MAX_FD"
        fi
    else
        warn "Could not query maximum file descriptor limit: $MAX_FD_LIMIT"
    fi
fi

# For Darwin, add options to specify how the application appears in the dock
if $darwin; then
    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
fi

# For Cygwin or MSYS, switch paths to Windows format before running java
if [ "$cygwin" = "true" -o "$msys" = "true" ] ; then
    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`

    JAVACMD=`cygpath --unix "$JAVACMD"`

    # We build the pattern for arguments to be converted via cygpath
    ROOTDIRSRAW=`find -L / -maxdepth 1 -mindepth 1 -type d 2>/dev/null`
    SEP=""
    for dir in $ROOTDIRSRAW ; do
        ROOTDIRS="$ROOTDIRS$SEP$dir"
        SEP="|"
    done
    OURCYGPATTERN="(^($ROOTDIRS))"
    # Add a user-defined pattern to the cygpath arguments
    if [ "$GRADLE_CYGPATTERN" != "" ] ; then
        OURCYGPATTERN="$OURCYGPATTERN|($GRADLE_CYGPATTERN)"
    fi
    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    i=0
    for arg in "$@" ; do
        CHECK=`echo "$arg"|egrep -c "$OURCYGPATTERN" -`
        CHECK2=`echo "$arg"|egrep -c "^-"`                                 ### Determine if an option

        if [ $CHECK -ne 0 ] && [ $CHECK2 -eq 0 ] ; then                    ### Added a condition
            eval `echo args$i`=`cygpath --path --ignore --mixed "$arg"`
        else
            eval `echo args$i`="\"$arg\""
        fi
        i=`expr $i + 1`
    done
    case $i in
        0) set -- ;;
        1) set -- "$args0" ;;
        2) set -- "$args0" "$args1" ;;
        3) set -- "$args0" "$args1" "$args2" ;;
        4) set -- "$args0" "$args1" "$args2" "$args3" ;;
        5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
        6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
        7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
        8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
        9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
    esac
fi

# Escape application args
save () {
    for i do printf %s\\n "$i" | sed "s/'/'\\\\''/g;1s/^/'/;\$s/\$/' \\\\/" ; done
    echo " "
}
APP_ARGS=`save "$@"`

# Collect all arguments for the java command, following the shell quoting and substitution rules
eval set -- $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS "\"-Dorg.gradle.appname=$APP_BASE_NAME\"" -classpath "\"$CLASSPATH\"" org.gradle.wrapper.GradleWrapperMain "$APP_ARGS"

exec "$JAVACMD" "$@"



================================================
FILE: desktop_app/gradlew.bat
================================================
@rem
@rem Copyright 2015 the original author or authors.
@rem
@rem Licensed under the Apache License, Version 2.0 (the "License");
@rem you may not use this file except in compliance with the License.
@rem You may obtain a copy of the License at
@rem
@rem      https://www.apache.org/licenses/LICENSE-2.0
@rem
@rem Unless required by applicable law or agreed to in writing, software
@rem distributed under the License is distributed on an "AS IS" BASIS,
@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
@rem See the License for the specific language governing permissions and
@rem limitations under the License.
@rem

@if "%DEBUG%" == "" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

set DIRNAME=%~dp0
if "%DIRNAME%" == "" set DIRNAME=.
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Resolve any "." and ".." in APP_HOME to make it shorter.
for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if "%ERRORLEVEL%" == "0" goto execute

echo.
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto execute

echo.
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar


@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*

:end
@rem End local scope for the variables with windows NT shell
if "%ERRORLEVEL%"=="0" goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
exit /b 1

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega



================================================
FILE: desktop_app/gradle/wrapper/gradle-wrapper.properties
================================================
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-7.0-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists



================================================
FILE: desktop_app/src/main/java/com/coveros/training/autoinsurance/AutoInsuranceAction.java
================================================
package com.coveros.training.autoinsurance;

import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apache.commons.lang3.builder.ToStringBuilder;


public final class AutoInsuranceAction {

    final int premiumIncreaseDollars;
    final WarningLetterEnum warningLetterEnum;
    final boolean isPolicyCanceled;
    final boolean isError;

    public AutoInsuranceAction(int premiumIncreaseDollars, WarningLetterEnum warningLetterEnum, boolean isPolicyCanceled, boolean isError) {

        this.premiumIncreaseDollars = premiumIncreaseDollars;
        this.warningLetterEnum = warningLetterEnum;
        this.isPolicyCanceled = isPolicyCanceled;
        this.isError = isError;
    }


    public final boolean equals(Object obj) {
        if (obj == null) {
            return false;
        }
        if (obj == this) {
            return true;
        }
        if (obj.getClass() != getClass()) {
            return false;
        }
        AutoInsuranceAction rhs = (AutoInsuranceAction) obj;
        return new EqualsBuilder()
                .append(premiumIncreaseDollars, rhs.premiumIncreaseDollars)
                .append(warningLetterEnum, rhs.warningLetterEnum)
                .append(isPolicyCanceled, rhs.isPolicyCanceled)
                .append(isError, rhs.isError)
                .isEquals();
    }

    public final int hashCode() {
        // you pick a hard-coded, randomly chosen, non-zero, odd number
        // ideally different for each class
        return new HashCodeBuilder(99, 5).
                append(premiumIncreaseDollars).
                append(warningLetterEnum).
                append(isPolicyCanceled).
                append(isError).
                toHashCode();
    }

    public static AutoInsuranceAction createEmpty() {
        return new AutoInsuranceAction(-1, WarningLetterEnum.NONE, false, false);
    }

    public static AutoInsuranceAction createErrorResponse() {
        return new AutoInsuranceAction(-1, WarningLetterEnum.NONE, false, true);
    }

    public boolean isEmpty() {
        return this.equals(createEmpty());
    }

    public final String toString() {
        return ToStringBuilder.reflectionToString(this);
    }
}



================================================
FILE: desktop_app/src/main/java/com/coveros/training/autoinsurance/AutoInsuranceProcessor.java
================================================
package com.coveros.training.autoinsurance;

class AutoInsuranceProcessor {

    private AutoInsuranceProcessor() {
        // private constructor to hide the public one.
    }

    static AutoInsuranceAction process(int claims, int age) {

        if (claims == 0 && age >= 16 && age <= 25) {
            return new AutoInsuranceAction(50, WarningLetterEnum.NONE, false, false);
        }

        if (claims == 0 && age >= 26 && age <= 85) {
            return new AutoInsuranceAction(25, WarningLetterEnum.NONE, false, false);
        }

        if (claims == 1 && age >= 16 && age <= 25) {
            return new AutoInsuranceAction(100, WarningLetterEnum.LTR1, false, false);
        }

        if (claims == 1 && age >= 26 && age <= 85) {
            return new AutoInsuranceAction(50, WarningLetterEnum.NONE, false, false);
        }

        if (claims >= 2 && claims <= 4 && age >= 16 && age <= 25) {
            return new AutoInsuranceAction(400, WarningLetterEnum.LTR2, false, false);
        }

        if (claims >= 2 && claims <= 4 && age >= 26 && age <= 85) {
            return new AutoInsuranceAction(200, WarningLetterEnum.LTR3, false, false);
        }

        if (claims >= 5) {
            return new AutoInsuranceAction(0, WarningLetterEnum.NONE, true, false);
        }

        // for any outside condition
        return AutoInsuranceAction.createErrorResponse();

    }


}



================================================
FILE: desktop_app/src/main/java/com/coveros/training/autoinsurance/AutoInsuranceScriptServer.java
================================================
package com.coveros.training.autoinsurance;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.beans.Transient;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.lang.annotation.Annotation;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Arrays;

public class AutoInsuranceScriptServer implements Runnable, Transient {

    static Logger logger = LoggerFactory.getLogger(AutoInsuranceScriptServer.class);
    private boolean shouldRepeat = true;
    private AutoInsuranceUI autoInsuranceUI;

    /**
     * Construct this with access to the UI we can control
     * @param autoInsuranceUI the UI we are controlling
     */
    public AutoInsuranceScriptServer(AutoInsuranceUI autoInsuranceUI) {
        this.autoInsuranceUI = autoInsuranceUI;
    }

    public void serverStart() {

        int portNumber = 8000;


        while(shouldRepeat) {
            try (
                    ServerSocket serverSocket = new ServerSocket(portNumber);
                    Socket clientSocket = serverSocket.accept();
            ) {
                PrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true);
                BufferedReader in = new BufferedReader(
                        new InputStreamReader(clientSocket.getInputStream()));
                String inputLine;
                while ((inputLine = in.readLine()) != null) {
                    String result = "OK";

                    final String[] inputTokens =
                            Arrays.stream(inputLine.split(" "))
                                    .map(String::toLowerCase).toArray(String[]::new);

                    try {
                        handleQuit(inputTokens);

                        handleSetCases(inputTokens);

                        result = handleGetCases(result, inputTokens);

                        handleClickActions(inputTokens);
                    } catch (Exception ex) {
                        logger.error(ex.getMessage());
                        result = "FAILURE";
                    }
                    out.println(result);

                }
            } catch (IOException e) {
                logger.error("Exception caught when trying to listen on port "
                        + portNumber + " or listening for a connection");
                logger.error(e.getMessage());
            }
        }
    }

    private void handleClickActions(String[] inputTokens) {
        if (inputTokens[0].equals("click") && inputTokens[1].equals("calculate")) {
            autoInsuranceUI.claimsCalcButton.doClick();
        }
    }

    private String handleGetCases(String result, String[] inputTokens) {
        if (inputTokens[0].equals("get")) {
            if (inputTokens[1].equals("label")) {
                result = autoInsuranceUI.label.getText();
            }
            if (inputTokens[1].equals("age")) {
                result = autoInsuranceUI.ageField.getText();
            }
            if (inputTokens[1].equals("claims")) {
                result = autoInsuranceUI.claimsDropDown.getSelectedItem().toString();
            }
        }
        return result;
    }

    private void handleSetCases(String[] inputTokens) {
        if (inputTokens[0].equals("set")) {
            if (inputTokens[1].equals("label")) {
                autoInsuranceUI.setLabel(inputTokens[2]);
            }
            if (inputTokens[1].equals("age")) {
                autoInsuranceUI.setClaimsAge(inputTokens[2]);
            }
            if (inputTokens[1].equals("claims")) {
                final int i = Integer.parseInt(inputTokens[2]);
                autoInsuranceUI.setPreviousClaims(i);
            }
        }
    }

    private void handleQuit(String[] inputTokens) {
        if (inputTokens[0].equals("quit")) {
            shouldRepeat = false;
        }
    }

    @Override
    public void run() {
        serverStart();
    }

    @Override
    public boolean value() {
        return false;
    }

    @Override
    public Class<? extends Annotation> annotationType() {
        return null;
    }
}



================================================
FILE: desktop_app/src/main/java/com/coveros/training/autoinsurance/AutoInsuranceUI.java
================================================
package com.coveros.training.autoinsurance;

import javax.swing.*;
import javax.swing.border.Border;
import java.awt.*;

import static javax.swing.JFrame.EXIT_ON_CLOSE;
import static javax.swing.SwingConstants.CENTER;

public class AutoInsuranceUI extends JPanel {

    // server used for automating the UI
    AutoInsuranceScriptServer autoInsuranceScriptServer;

    JLabel label;
    JComboBox<String> claimsDropDown;
    JTextField ageField;
    JButton claimsCalcButton;
    JFrame frame;

    /** Creates the GUI shown inside the frame's content pane. */
    public AutoInsuranceUI(JFrame frame) {
        super(new BorderLayout());
        this.frame = frame;

        JPanel autoInsurancePanel = createAutoInsurancePanel();

        //Lay them out.
        Border padding = BorderFactory.createEmptyBorder(20,20,5,20);
        autoInsurancePanel.setBorder(padding);

        add(autoInsurancePanel, BorderLayout.CENTER);
        label = new JLabel("Click the \"Crunch\" button"
                + " to calculate your auto insurance results",
                CENTER);
        add(label, BorderLayout.PAGE_END);
        label.setBorder(BorderFactory.createEmptyBorder(10,10,10,10));

        startSocketServer();
    }

    private JPanel createAutoInsurancePanel() {
        JPanel box = new JPanel();

        box.setLayout(new BoxLayout(box, BoxLayout.PAGE_AXIS));

        addLabel(box, "Previous claims:");
        claimsDropDown = addClaimsDropDown(box);

        addLabel(box, "Driver's age:");
        ageField = addClaimsAgeTextField(box);

        claimsCalcButton = addClaimsCalcButton(box);
        claimsCalcButton.addActionListener(e -> {
            final int intPreviousClaims = getIntPreviousClaims();
            final String customerAge = ageField.getText();
            final int intCustomerAge = Integer.parseInt(customerAge);

            final AutoInsuranceAction result = AutoInsuranceProcessor.process(intPreviousClaims, intCustomerAge);

            setLabel(
                    "Premium increase: $" +  result.premiumIncreaseDollars +
                    " Warning Ltr: " + result.warningLetterEnum +
                    " is canceled: " + result.isPolicyCanceled);
        });

        return box;
    }

    /**
     * This method returns an integer representing the number of previous claims for a customer.
     */
    private int getIntPreviousClaims() {
        final String numberPreviousClaims = (String)claimsDropDown.getSelectedItem();

        assert numberPreviousClaims != null;
        switch (numberPreviousClaims) {
            case "0" : return 0;
            case "1" : return 1;
            case "2-4" : return 2;
            case ">=5" : return 5;
            default:
                throw new InvalidClaimsException("invalid value entered");
        }
    }

    private JTextField addClaimsAgeTextField(JPanel box) {
        JTextField textField = new JTextField();
        textField.setVisible(true);
        box.add(textField);
        return textField;
    }

    private JButton addClaimsCalcButton(JPanel box) {
        JButton crunch = new JButton("Crunch");
        crunch.setVisible(true);
        box.add(crunch);
        return crunch;
    }

    private void addLabel(JPanel box, String msg) {
        JLabel lbl = new JLabel(msg);
        lbl.setVisible(true);
        box.add(lbl);
    }

    private JComboBox<String> addClaimsDropDown(JPanel box) {
        String[] previousClaims = {"0", "1", "2-4", ">=5"};
        final JComboBox<String> cb = new JComboBox<>(previousClaims);
        cb.setVisible(true);
        box.add(cb);
        return cb;
    }

    /**
     * start a socket server that can run commands on this UI.
     * This is to enable automation scripts.
     */
    private void startSocketServer() {
        autoInsuranceScriptServer = new AutoInsuranceScriptServer(this);

        Thread newThread = new Thread(autoInsuranceScriptServer);
        newThread.start();
    }

    /**
     * Sets the text at the bottom of the panel
     * @param newText whatever you want the new text to be
     */
    void setLabel(String newText) {
        label.setText(newText);
    }

    /**
     * Selects one of the drop-down items for previous claims
     * @param claims number of previous claims
     */
    void setPreviousClaims(int claims) {
        if (claims <= 0) {
            claimsDropDown.setSelectedIndex(0);
        }

        if (claims == 1) {
            claimsDropDown.setSelectedIndex(1);
        }

        if (claims >= 2 && claims <= 4) {
            claimsDropDown.setSelectedIndex(2);
        }

        if (claims >= 5) {
            claimsDropDown.setSelectedIndex(3);
        }
    }

    /**
     * Sets the age field per what you enter
     * @param age the text that goes into the age field.
     */
    void setClaimsAge(String age) {
        ageField.setText(age);
    }

    /**
     * Create the GUI and show it.  For thread safety,
     * this method should be invoked from the
     * event-dispatching thread.
     */
    private static void createAndShowGUI() {
        //Create and set up the window.
        JFrame frame = new JFrame("AutoInsuranceUI");
        frame.setDefaultCloseOperation(EXIT_ON_CLOSE);

        //Create and set up the content pane.
        AutoInsuranceUI newContentPane = new AutoInsuranceUI(frame);
        newContentPane.setOpaque(true); //content panes must be opaque
        frame.setContentPane(newContentPane);

        //Display the window.
        frame.pack();
        frame.setVisible(true);
    }

    public static void main(String[] args) {
        //Schedule a job for the event-dispatching thread:
        //creating and showing this application's GUI.
        javax.swing.SwingUtilities.invokeLater(() -> createAndShowGUI());
    }

    // stops and closes the application
    public void close() {
        this.frame.dispose();
        System.exit(0);
    }
}




================================================
FILE: desktop_app/src/main/java/com/coveros/training/autoinsurance/InvalidClaimsException.java
================================================
package com.coveros.training.autoinsurance;

public class InvalidClaimsException extends RuntimeException {
    public InvalidClaimsException(String ex) {
        super(ex);
    }
}



================================================
FILE: desktop_app/src/main/java/com/coveros/training/autoinsurance/WarningLetterEnum.java
================================================
package com.coveros.training.autoinsurance;

/**
 * The identifiers of different letters that get sent out for
 * different numbers of claims and age of the driver.
 */
public enum WarningLetterEnum {
    NONE,
    LTR1,
    LTR2,
    LTR3
}



================================================
FILE: desktop_app/src/main/resources/log4j2.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<Configuration monitorinterval="30" status="info" strict="true">

    <Appenders>
        <Appender type="Console" name="Console">
            <Layout type="PatternLayout" pattern="%d %p %m%n"/>
        </Appender>
    </Appenders>

    <Loggers>
        <Root level="INFO">
            <AppenderRef ref="Console"/>
        </Root>
    </Loggers>

</Configuration>



================================================
FILE: desktop_app/src/test/java/com/coveros/training/autoinsurance/AutoInsuranceActionTests.java
================================================
package com.coveros.training.autoinsurance;

import nl.jqno.equalsverifier.EqualsVerifier;
import org.junit.Assert;
import org.junit.Test;

import static com.coveros.training.autoinsurance.WarningLetterEnum.LTR1;

public class AutoInsuranceActionTests {

    @Test
    public void testShouldHaveEqualsAndHashcodeImplementedCorrectly() {
        EqualsVerifier.forClass(AutoInsuranceAction.class).verify();
    }

    @Test
    public void testShouldOutputGoodString() {
        final AutoInsuranceAction action = createTestAutoInsuranceAction();
        Assert.assertTrue("toString was: " + action.toString(), action.toString().contains("premiumIncreaseDollars=50,warningLetterEnum=LTR1,isPolicyCanceled=false"));
    }

    public static AutoInsuranceAction createTestAutoInsuranceAction() {
        return new AutoInsuranceAction(50, LTR1, false, false);
    }

    @Test
    public void testCanCreateEmpty() {
        final AutoInsuranceAction autoInsuranceAction = AutoInsuranceAction.createEmpty();
        Assert.assertTrue(autoInsuranceAction.isEmpty());
    }
}



================================================
FILE: desktop_app/src/test/java/com/coveros/training/autoinsurance/AutoInsuranceProcessorTests.java
================================================
package com.coveros.training.autoinsurance;

import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;
import org.junit.runners.Parameterized.Parameters;

import java.util.Arrays;
import java.util.Collection;

@RunWith(Parameterized.class)
public class AutoInsuranceProcessorTests {

    @Parameters
    public static Collection<Object[]> data() {

        // three-point bounds testing
        return Arrays.asList(new Object[][]{
        // claims,  age,  premiumIncrease,  warningLetter,  cancelPolicy, isError
                {0, 15, -1, WarningLetterEnum.NONE, false, true},
                {0, 16, 50, WarningLetterEnum.NONE, false, false},
                {0, 17, 50, WarningLetterEnum.NONE, false, false},

                {0, 25, 50, WarningLetterEnum.NONE, false, false},
                {0, 26, 25, WarningLetterEnum.NONE, false, false},
                {0, 27, 25, WarningLetterEnum.NONE, false, false},

                {0, 84, 25, WarningLetterEnum.NONE, false, false},
                {0, 85, 25, WarningLetterEnum.NONE, false, false},
                {0, 86, -1, WarningLetterEnum.NONE, false, true},

                {1, 15, -1, WarningLetterEnum.NONE, false, true},
                {1, 16, 100, WarningLetterEnum.LTR1, false, false},
                {1, 17, 100, WarningLetterEnum.LTR1, false, false},

                {1, 25, 100, WarningLetterEnum.LTR1, false, false},
                {1, 26, 50, WarningLetterEnum.NONE, false, false},
                {1, 27, 50, WarningLetterEnum.NONE, false, false},

                {1, 84, 50, WarningLetterEnum.NONE, false, false},
                {1, 85, 50, WarningLetterEnum.NONE, false, false},
                {1, 86, -1, WarningLetterEnum.NONE, false, true},

                {2, 15, -1, WarningLetterEnum.NONE, false, true},
                {2, 16, 400, WarningLetterEnum.LTR2, false, false},
                {2, 17, 400, WarningLetterEnum.LTR2, false, false},

                {2, 25, 400, WarningLetterEnum.LTR2, false, false},
                {2, 26, 200, WarningLetterEnum.LTR3, false, false},
                {2, 27, 200, WarningLetterEnum.LTR3, false, false},

                {2, 84, 200, WarningLetterEnum.LTR3, false, false},
                {2, 85, 200, WarningLetterEnum.LTR3, false, false},
                {2, 86, -1, WarningLetterEnum.NONE, false, true},

                {4, 15, -1, WarningLetterEnum.NONE, false, true},
                {4, 16, 400, WarningLetterEnum.LTR2, false, false},
                {4, 17, 400, WarningLetterEnum.LTR2, false, false},

                {4, 25, 400, WarningLetterEnum.LTR2, false, false},
                {4, 26, 200, WarningLetterEnum.LTR3, false, false},
                {4, 27, 200, WarningLetterEnum.LTR3, false, false},

                {4, 84, 200, WarningLetterEnum.LTR3, false, false},
                {4, 85, 200, WarningLetterEnum.LTR3, false, false},
                {4, 86, -1, WarningLetterEnum.NONE, false, true},

                {5, 26, 0, WarningLetterEnum.NONE, true, false},
                {6, 26, 0, WarningLetterEnum.NONE, true, false},
                {5, 80, 0, WarningLetterEnum.NONE, true, false},

                {-1, 80, -1, WarningLetterEnum.NONE, false, true},
        });
    }

    private int claims;
    private int age;
    private int premiumIncrease;
    private WarningLetterEnum warningLetter;
    private boolean cancelPolicy;
    private boolean isError;

    public AutoInsuranceProcessorTests(int claims, int age, int premiumIncrease, WarningLetterEnum warningLetter, boolean cancelPolicy, boolean isError) {
        this.claims = claims;
        this.age = age;
        this.premiumIncrease = premiumIncrease;
        this.warningLetter = warningLetter;
        this.cancelPolicy = cancelPolicy;
        this.isError = isError;
    }

    @Test
    public void testProcessor() {

        AutoInsuranceAction action = AutoInsuranceProcessor.process(claims, age);

        AutoInsuranceAction expectedAutoInsuranceAction = new AutoInsuranceAction(premiumIncrease, warningLetter, cancelPolicy, isError);

        Assert.assertEquals("claims: " + claims + " age: " + age, expectedAutoInsuranceAction, action);
    }
}



================================================
FILE: desktop_app/src/test/java/com/coveros/training/autoinsurance/AutoInsuranceScriptClient.java
================================================
package com.coveros.training.autoinsurance;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;
import java.net.UnknownHostException;

public class AutoInsuranceScriptClient {

    public static final String QUIT = "quit";
    static Logger logger = LoggerFactory.getLogger(AutoInsuranceScriptClient.class);

    public String send(String command) {
        String hostName = "localhost";
        String result = "";
        int portNumber = 8000;
        try (Socket echoSocket = new Socket(hostName, portNumber)) {
            PrintWriter out = new PrintWriter(echoSocket.getOutputStream(), true);
            BufferedReader in =
                    new BufferedReader(
                            new InputStreamReader(echoSocket.getInputStream()));
            logger.info("running command: {}", command);
            if (command.equals(QUIT)) {
                result = processCommand(out, in, command);
            }
            result = processCommand(out, in, command);
        } catch (UnknownHostException e) {
            logger.error("Don't know about host {}", hostName);
        } catch (IOException e) {
            logger.error("Couldn't get I/O for the connection to {}", hostName);
        }
        return result;
    }

    private String processCommand(PrintWriter out, BufferedReader in, String command) throws IOException {
        logger.info("sending: {}", command);
        out.println(command);
        final String response = in.readLine();
        logger.info("response: {}", response);
        return response;
    }

}



================================================
FILE: desktop_app/src/test/java/com/coveros/training/autoinsurance/DesktopTester.java
================================================
package com.coveros.training.autoinsurance;

public class DesktopTester {
    private final AutoInsuranceScriptClient scriptClient;

    public DesktopTester(AutoInsuranceScriptClient scriptClient) {
        this.scriptClient = scriptClient;
    }


    public void setAge(int age) {
        scriptClient.send(String.format("set age %d", age));
    }

    public void setClaims(int claims) {
        scriptClient.send(String.format("set claims %d", claims));
    }

    public void clickCalculate() {
        scriptClient.send("click calculate");
    }

    public String getLabel() {
        return scriptClient.send("get label");
    }

    /**
     * kill the desktop UI and the tester client
     */
    public void quit() {
        scriptClient.send(AutoInsuranceScriptClient.QUIT);
    }
}



================================================
FILE: desktop_app/src/test/java/com/coveros/training/autoinsurance/DesktopUiTests.java
================================================
package com.coveros.training.autoinsurance;

import org.junit.After;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;

public class DesktopUiTests {

    @Before
    public void startUI() {
        AutoInsuranceUI.main(new String[]{});
    }

    /**
     * An initial test to make sure the basics work
     */
    @Test
    public void testShouldGetCorrectCalculationHappyPath() {
        DesktopTester dt = new DesktopTester(new AutoInsuranceScriptClient());
        dt.setAge(22);
        dt.setClaims(1);
        dt.clickCalculate();
        final String label = dt.getLabel();
        dt.quit();
        Assert.assertEquals("Premium increase: $100 Warning Ltr: LTR1 is canceled: false", label);
    }


}



================================================
FILE: desktop_app/src/test/java/com/coveros/training/autoinsurance/ExecutionDataClient.java
================================================
package com.coveros.training.autoinsurance;

/*******************************************************************************
 * Copyright (c) 2009, 2020 Mountainminds GmbH & Co. KG and Contributors
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *    Marc R. Hoffmann - initial API and implementation
 *
 *******************************************************************************/

import org.jacoco.core.data.ExecutionDataWriter;
import org.jacoco.core.runtime.RemoteControlReader;
import org.jacoco.core.runtime.RemoteControlWriter;

import java.io.FileOutputStream;
import java.io.IOException;
import java.net.InetAddress;
import java.net.Socket;

/**
 * This example connects to a coverage agent that run in output mode
 * <code>tcpserver</code> and requests execution data. The collected data is
 * dumped to a local file.
 */
public class ExecutionDataClient {

    private static final String ADDRESS = "localhost";

    /**
     * Starts the Jacoco execution data request.
     * First argument is the port to connect to, second is the file to write to.
     */
    public static void main(final String[] args) throws IOException {
        int port = Integer.parseInt(args[0]);
        String destfile = args[1];
        final FileOutputStream localFile = new FileOutputStream(destfile);
        final ExecutionDataWriter localWriter = new ExecutionDataWriter(
                localFile);

        // Open a socket to the coverage agent:
        try (Socket socket = new Socket(InetAddress.getByName(ADDRESS), port)) {
            final RemoteControlWriter writer = new RemoteControlWriter(
                    socket.getOutputStream());
            final RemoteControlReader reader = new RemoteControlReader(
                    socket.getInputStream());
            reader.setSessionInfoVisitor(localWriter);
            reader.setExecutionDataVisitor(localWriter);

            // Send a dump command and read the response:
            writer.visitDumpCommand(true, true);
            if (!reader.read()) {
                throw new IOException("Socket closed unexpectedly.");
            }

        }
        localFile.close();
    }

    private ExecutionDataClient() {
    }
}


================================================
FILE: docs/README.txt
================================================
Contents of the docs directory
------------------------------

/api_testing                      : testing web API's
/ci_and_cd                        : Setting up continuous integration and delivery systems
/dev_notes                        : details of the system appropriate for developers
/performance_testing              : testing performance of a system
/security_testing                 : testing security of a system
/ui_testing                       : UI testing, primarily using Selenium
coveros_text.txt                  : help text with a fancy Coveros ascii graphic (also shown with gradlew coveros).
desktop_automation.txt            : A guide on automating non-web-applications
test.py                           : A Python script that shows page object model techniques for web testing.
BDD.md                            : A BDD / TDD walkthrough.




================================================
FILE: docs/coveros_text.txt
================================================
                                 .ccccccccc..                                  Interesting links when the system is up:
                        .cccccccccc                                            ----------------------------------------
                  cCCCCCCCC                                                    http://localhost:8080/demo - the main application
             .CCCCCCCCCCc                                                      http://localhost:8080/demo/console - the database viewer
         .cCCCCCCCCCC/                                                               (use URL of jdbc:h2:mem:training and no user or password)
      /CCCCCCCCCCC/                                                            http://localhost:8080/demo/monitoring - monitoring of the server
    /CCCCCCCCCCCC/
   /CCCCCCCCCCCC/        .dCCCCb. .dOOOOb. dP   .dP .dEEEEb. RRdRRRb. .dOOOOb. .dSSSSb.
  /CCCCCCCCCCCC/         CC'  `"" OO'  `OO VV   dV' EEoooodC RR'  `RR OO'  `OO YSooooo.
 |CCCCCCCCCCCCC|         CC.  ... OO.  .OO VV .VV'  EE.  ... RR       OO.  .OO       SS
 |CCCCCCCCCCCCC|         `CCCCCP' `OOOOOP' VVVVP'   `EEEEEP' dR       `OOOOOP' `SSSSSP
 .CCCCCCCCCCCCC\
  \CCCCCCCCCCCCCC\                           ____  _____ __  __  ___
   \CCCCCCCCCCCCCC\                         |  _ \| ____|  \/  |/ _ \          Summary of relevant Gradle commands
    \CCCCCCCCCCCCCCc\                       | | | |  _| | |\/| | | | |         ------------------------------------
       \CCCCCCCCCCCCCCc                     | |_| | |___| |  | | |_| |
          .CCCCCCCCCCCCCCCc                 |____/|_____|_|  |_|\___/          gradlew apprun         - Runs the application
             *\CCCCCCCCCCCCCCCC\c                                              gradlew check          - Runs all tests solely using Java
                  ^\CCCCCCCCCCCCCCCCccc                                        gradlew runAllTests    - Runs the whole set of tests**
                        ^^^*CCCCCCCCCCCCCCCCCCCCCCCCCCcc..                     gradlew clean          - Cleans build products and installs pre-push hook.
                                   ^^^^^^^^^^^^^^^^^                           gradlew runBehaveTests - Runs the UI tests**
                                                                               gradlew runApiTests    - Runs the API tests**
                                                                               gradlew selenified     - Runs some Selenified tests**
                                                                               gradlew pitest         - Runs mutation testing (see http://pitest.org/)
                                                                               gradlew sonarqube      - Runs static analysis using SonarQube.
                                                                                                        (SonarQube must be running on localhost:9000)

gradlew generateCucumberReport   - Runs cucumber and creates a nice-looking HTML report.
gradlew dependencyCheckAnalyze   - Analyzes security reports for the dependencies of this project.
gradlew integrate                - Runs the database integration tests.
gradlew startH2Console           - Starts a console to examine the H2 database file.
gradlew <task 1>... taskTree     - A utility that will show the task tree for a particular task.

** Requires the app to be running (usually in another terminal) and all optional dependencies installed.



================================================
FILE: docs/api_testing/README.txt
================================================
api_testing_with_curl.txt         : How to call API endpoints with Curl https://curl.haxx.se/
api_testing_with_soapui.txt       : How to test API with SoapUI https://www.soapui.org/
soapui_demo_tests.xml             : A SoapUI file to demonstrate API testing.
tester.postman_collection.json    : Postman tests


================================================
FILE: docs/api_testing/api_testing_with_curl.txt
================================================
#!/bin/sh

#How to do manual API testing
#----------------------------

curl http://localhost:8080/demo/math --data "item_a=9&item_b=7"
curl http://localhost:8080/demo/register --data "username=alice&password=B65S3xNW8vXQHyjYnD72L3mejc"
curl http://localhost:8080/demo/login --data "username=alice&password=B65S3xNW8vXQHyjYnD72L3mejc"
curl http://localhost:8080/demo/registerbook --data "book=alice+in+wonderland"
curl http://localhost:8080/demo/registerborrower --data "borrower=alice"
curl http://localhost:8080/demo/lend --data "book=alice+in+wonderland&borrower=alice"








================================================
FILE: docs/api_testing/api_testing_with_soapui.txt
================================================
Start the demo project by running gradlew apprun

Open SoapUI

Import a project, select "soapui_demo_tests.xml" in the demo/docs directory

Double-click on Math_TestSuite

click the green arrow to run the Test Suite.


================================================
FILE: docs/api_testing/soapui_demo_tests.xml
================================================
<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="111909e8-f8d3-4eac-bef6-a52466912526" activeEnvironment="Default" name="Demo" resourceRoot="" soapui-version="5.4.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.actions.iface.tools.soapui.TestRunnerAction@values-local"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="Report Format(s)" value=""/>
  <con:entry key="Host:Port" value=""/>
  <con:entry key="Export JUnit Results" value="false"/>
  <con:entry key="Export All" value="false"/>
  <con:entry key="Save After" value="false"/>
  <con:entry key="Add Settings" value="false"/>
  <con:entry key="WSS Password Type" value=""/>
  <con:entry key="TestSuite" value="Math_TestSuite"/>
  <con:entry key="Endpoint" value=""/>
  <con:entry key="Select Report Type" value=""/>
  <con:entry key="System Properties" value=""/>
  <con:entry key="Password" value=""/>
  <con:entry key="Print Report" value="false"/>
  <con:entry key="Open Report" value="false"/>
  <con:entry key="Export JUnit Results with test properties" value="false"/>
  <con:entry key="Global Properties" value=""/>
  <con:entry key="Project Properties" value=""/>
  <con:entry key="Project Password" value=""/>
  <con:entry key="TestCase" value="TestCase 1 - HappyPath"/>
  <con:entry key="Username" value=""/>
  <con:entry key="user-settings.xml Password" value=""/>
  <con:entry key="TestRunner Path" value=""/>
  <con:entry key="Environment" value="Default"/>
  <con:entry key="Coverage Report" value="false"/>
  <con:entry key="Enable UI" value="false"/>
  <con:entry key="Root Folder" value=""/>
  <con:entry key="Ignore Errors" value="false"/>
  <con:entry key="Domain" value=""/>
  <con:entry key="Tool Args" value=""/>
  <con:entry key="Save Project" value="false"/>
</xml-fragment>]]></con:setting></con:settings><con:interface xsi:type="con:RestService" id="cfce851e-01d5-4402-ae97-963cd5d99225" wadlVersion="http://wadl.dev.java.net/2009/02" name="http://localhost:8080" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints><con:endpoint>http://localhost:8080</con:endpoint></con:endpoints><con:resource name="Demo_math" path="/demo/math" id="0f6c5e45-be92-4a25-8683-8790bf3646d3"><con:settings/><con:parameters/><con:method name="Math" id="1bf79c97-8151-48dc-a03d-1926b68a3f9e" method="POST"><con:settings/><con:parameters><con:parameter><con:name>item_a</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>item_b</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>text/html;charset=UTF-8</con:mediaType><con:status>200</con:status><con:params/><con:element>html</con:element></con:representation><con:request name="two_small_positive_ints" id="e36d3aaf-9d3d-44bd-acfb-a03649893d4b" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="4"/>
  <con:entry key="item_a" value="3"/>
</con:parameters></con:request></con:method></con:resource></con:interface><con:testSuite id="7223e62f-6ee9-4d31-a146-8f6a303f9830" name="Math_TestSuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="53a850ba-07dd-4c1d-96a5-1feaf3595b98" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 1 - two small ints" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="188ec0e8-fdaf-43b3-8fd4-d77159ba5ff4"><con:settings/><con:config service="http://localhost:8080" resourcePath="/demo/math" methodName="Math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="e36d3aaf-9d3d-44bd-acfb-a03649893d4b" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="9aebbc7f-8304-4a32-a46f-9bd7216abf3a" name="Contains"><con:configuration><token>7</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="4"/>
  <con:entry key="item_a" value="3"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="d7228d76-69b9-4051-b2d2-b3f7a61e8403" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 2 - two  larger positive ints" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="868add2e-eac9-4f1d-90eb-7a32c54057c7"><con:settings/><con:config service="http://localhost:8080" methodName="Math" resourcePath="/demo/math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="fb12b576-d937-428e-9766-cd28306cba56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="b9d08d6d-9fa6-47cb-a443-b46ee715f605" name="Contains"><con:configuration><token>4000</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="3000"/>
  <con:entry key="item_a" value="1000"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="eaa1c68a-2a77-4fe5-b09e-9c85308af797" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 3 - two  larger negative ints" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="21f55269-3bd0-4ced-9687-84b516c71083"><con:settings/><con:config service="http://localhost:8080" methodName="Math" resourcePath="/demo/math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="fb12b576-d937-428e-9766-cd28306cba56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="b9d08d6d-9fa6-47cb-a443-b46ee715f605" name="Contains"><con:configuration><token>-4000</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="-3000"/>
  <con:entry key="item_a" value="-1000"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="2cb8f07a-cb53-4851-862e-72a27773ac66" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 4 - two small negative ints" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="6a30f959-f212-463b-a1aa-1cf6680f4373"><con:settings/><con:config service="http://localhost:8080" methodName="Math" resourcePath="/demo/math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="fb12b576-d937-428e-9766-cd28306cba56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="b9d08d6d-9fa6-47cb-a443-b46ee715f605" name="Contains"><con:configuration><token>-56</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="-33"/>
  <con:entry key="item_a" value="-23"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="60c91b99-6149-4b05-bbb9-71137af95715" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 5- negative case - decimal" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="REST Request" id="50a89f2b-03ea-4507-b414-58fc5e8b1612"><con:settings/><con:config service="http://localhost:8080" methodName="Math" resourcePath="/demo/math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="fb12b576-d937-428e-9766-cd28306cba56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="b9d08d6d-9fa6-47cb-a443-b46ee715f605" name="Contains"><con:configuration><token>Error: only accepts integers</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="Simple Contains" id="d8536417-6a15-44c8-8155-7d45d9d40033"><con:configuration/></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="-33"/>
  <con:entry key="item_a" value="1.1"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="483d33c3-b4fa-4cf6-91f4-d4b026bed0dd" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 6- negative case - too large addend" searchProperties="true"><con:description>If the numbers provided to add are individually larger than 2,147,483,647, or if they 
add to that number or larger, then the result won't be as expected.

In this test we will test with one addend being too large</con:description><con:settings/><con:testStep type="restrequest" name="REST Request" id="a247e72f-7fe5-4c01-ab52-304297670b04"><con:settings/><con:config service="http://localhost:8080" methodName="Math" resourcePath="/demo/math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="fb12b576-d937-428e-9766-cd28306cba56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="b9d08d6d-9fa6-47cb-a443-b46ee715f605" name="Contains"><con:configuration><token>Error: addend too large - maximum of 2,147,483,647 in a single addend</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="-33"/>
  <con:entry key="item_a" value="2147483648"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:testCase id="5395395c-0a98-4bfc-b615-0b6b1cc68a00" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TestCase 7- negative case - too large sum" searchProperties="true"><con:description>If the numbers provided to add are individually larger than 2,147,483,647, or if they 
add to that number or larger, then the result won't be as expected.

In this test we will test with the sum being above that number</con:description><con:settings/><con:testStep type="restrequest" name="REST Request" id="f30398f3-d98a-46bf-aba1-2974e0f5ec2a"><con:settings/><con:config service="http://localhost:8080" methodName="Math" resourcePath="/demo/math" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="REST Request" id="fb12b576-d937-428e-9766-cd28306cba56" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080</con:endpoint><con:request/><con:originalUri>http://localhost/demo/math</con:originalUri><con:assertion type="Simple Contains" id="b9d08d6d-9fa6-47cb-a443-b46ee715f605" name="Contains"><con:configuration><token>Error: sum too large - maximum of (absolute) 2,147,483,647</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="item_b" value="1"/>
  <con:entry key="item_a" value="2147483647"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:properties/><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>


================================================
FILE: docs/api_testing/tester.postman_collection.json
================================================
{
	"info": {
		"_postman_id": "70251e20-e7d7-4fad-a126-f85753e54fd7",
		"name": "tester",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "basic math happy path",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "e9f77377-24dc-448a-813b-5529f090fec8",
						"exec": [
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"8\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=3&item_b=5",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "3"
						},
						{
							"key": "item_b",
							"value": "5"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "maximum positive number plus 0",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "74f49090-3e21-4ded-a420-2b944b5cdeb8",
						"exec": [
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"2147483647\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=2147483647&item_b=0",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "2147483647"
						},
						{
							"key": "item_b",
							"value": "0"
						}
					]
				},
				"description": "This should return the maximum positive int in a signed 32-bit integer"
			},
			"response": []
		},
		{
			"name": "maximum negative number plus 0",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "55b23df5-815a-412f-a613-e1e2b7041c9e",
						"exec": [
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"-2147483648\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=-2147483648&item_b=0",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "-2147483648"
						},
						{
							"key": "item_b",
							"value": "0"
						}
					]
				},
				"description": "This should return the maximum positive int in a signed 32-bit integer"
			},
			"response": []
		},
		{
			"name": "maximum positive number plus maximum positive number",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "b6fea037-956d-44d5-9b54-3c92397ba997",
						"exec": [
							"// is this a good test?  do we want to accept negative 2 as an answer?",
							"// In my opinion, we should assert that some kind of overflor error message has been returned,",
							"// and change the code to suit that.",
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"-2\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=2147483647&item_b=2147483647",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "2147483647"
						},
						{
							"key": "item_b",
							"value": "2147483647"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "maximum negative number plus maximum negative number",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "b9973844-ec4c-420d-ad01-5c5bc80f2a95",
						"exec": [
							"// is this a good test?  do we want to accept this as an answer?",
							"// In my opinion, we should assert that some kind of overflor error message has been returned,",
							"// and change the code to suit that.",
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"2\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=-2147483648 &item_b=-2147483648 ",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "-2147483648 "
						},
						{
							"key": "item_b",
							"value": "-2147483648 "
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "maximum positive number plus 1 - return error",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c89f1166-b079-462f-a1c0-7966aaf6f8fc",
						"exec": [
							"// is this a good test?  do we want to accept this as an answer?",
							"// In my opinion, we should assert that some kind of overflor error message has been returned,",
							"// and change the code to suit that.",
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"-2\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=2147483647&item_b=1",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "2147483647"
						},
						{
							"key": "item_b",
							"value": "1"
						}
					]
				},
				"description": "This should return the maximum negative int in a signed 32-bit integer"
			},
			"response": []
		},
		{
			"name": "maximum negative number minus 1 - return error",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "a77f3bfe-a528-4cdf-8f9d-908a201c64d7",
						"exec": [
							"// is this a good test?  do we want to accept this as an answer?",
							"// In my opinion, we should assert that some kind of overflor error message has been returned,",
							"// and change the code to suit that.",
							"pm.test(\"Body matches string\", function () {",
							"    pm.expect(pm.response.text()).to.include(\"-2\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"url": {
					"raw": "http://localhost:8080/demo/math?item_a=-2147483648&item_b=-1",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8080",
					"path": [
						"demo",
						"math"
					],
					"query": [
						{
							"key": "item_a",
							"value": "-2147483648"
						},
						{
							"key": "item_b",
							"value": "-1"
						}
					]
				},
				"description": "This should return the maximum positive int in a signed 32-bit integer"
			},
			"response": []
		}
	],
	"protocolProfileBehavior": {}
}


================================================
FILE: docs/ci_and_cd/README.txt
================================================
ci_and_cd_for_localhost.txt       : instructions for setting up a CI/CD pipeline all-in-one on a Windows box
install_docker_centos.txt         : Instructions for setting up Docker on CentOS.
jenkins_box_guide.txt             : How to set up a CI/CD server on CentOS.
ui_test_box.txt                   : Instructions for setting up a server to run UI testing.
virtualbox_networking.txt         : Details of how networking is configured for the virtual machines.


================================================
FILE: docs/ci_and_cd/ci_and_cd_for_localhost.txt
================================================
installing a ci/cd pipeline on a Windows computer.
-------------------------------------------------

The following assumes you have already installed the necessary components to run "gradlew runalltests" on your computer -
this entails having JDK11, Python, Chromedriver in a directory on your path, etc... see README.md in the top directory of Demo.

The gist of the following is as follows:
we install and run Tomcat, Sonarqube, and Jenkins.
We configure the Jenkins pipeline.
We set up a fake central repository in a local directory so that when we push any code to it, Jenkins starts up.
This should go smoothly, but there are inevitable kinks when configuring real software.
Please contact me with any issues found.


I did this on Windows, other operating systems would require some changes.

Install the latest Git.
Put this on your path: C:\Program Files\Git\usr\bin (so Jenkins has access to unix-style commands while running the pipeline)

Download and install JDK11, put it on your path (Sonarqube 8 requires JDK11)

Install Jmeter, put the path to its bin directory on the path.
Read "Installing Jmeter" in the document "perf_testing_with_jmeter.txt", follow that.

Download Demo somewhere - it's at https://github.com/7ep/demo

Download Sonarqube https://www.sonarqube.org/downloads/
Unzip the file somewhere and drop down into its bin directory and start it up.

Create a fake central repo on your machine.  This is where Jenkins will look
for new code changes.  I put mine at C:\Users\byron\fake_central_repo\demo, you can put yours anywhere.

create the directory, then in that directory, run a git init:
git init --bare

Back in the original Demo directory, create a git remote that points to the fake repo.  I called mine "fakecentralrepo"

# the following will add the remote location
git remote add fakecentralrepo ../fake_central_repo/demo

# the following will set the remote location as the default remote
git push -u fakecentralrepo master

Download Tomcat9 core binary distribution for your machine: https://tomcat.apache.org/download-90.cgi

Modify the server.xml in the Tomcat "conf/" directory, at the bottom of the file there is a <Host> section.  This will allow Tomcat to serve the static content that is generated during a build. Place the following inside, so that you get something like this:

      <Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true">
        <Context docBase="/c:/Users/YOUR_NAME_HERE/.jenkins/workspace" path="/workspace" />

Additionally, create the previously mentioned workspace directory:
	mkdir -p <path_to_your_user_directory>/.jenkins/workspace

In conf/context.xml, add the following inside of the main <Context> element, to avoid a complaint by Tomcat about "nsufficient free space available after evicting expired cache entries - consider increasing the maximum size of the cache"

    <Resources cachingAllowed="true" cacheMaxSize="100000" />

In the Tomcat /bin directory, create a new file, setenv.bat
Give it this content (this is so we can connect with JMX dynamic analysis tools to Tomcat):
set CATALINA_OPTS=%CATALINA_OPTS% -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=localhost

or on MacOs, setenv.sh. Give it this content:
export CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=localhost"

and be sure to set it as executable

Start up Tomcat (look in the bin directory for a "startup" file)

Download the Jenkins war file:

http://mirrors.jenkins.io/war-stable/latest/jenkins.war

Place the war into the webapps directory in Tomcat.  Doing so will boot up Jenkins.

go to localhost:8080/jenkins once it has a few seconds to finish booting.

Choose "Install Suggested Plugins"

I created an admin with the following characteristics:
username: admin
password: admin
email: admin@test.com

(save and continue)

To install the Sidebar-Link plugin, go to:

http://localhost:8080/jenkins/pluginManager/available

and search for "sidebar".  Choose Sidebar Link and "Install without restart"



CONFIGURE PIPELINE TO RUN AT GIT RECEIVE
----------------------------------------

We want to have the ability to notify Jenkins whenever we push
to our new repo.  Jenkins has a capability of running builds whenever
a certain endpoint is hit. 

Download the command-line-interface (CLI) tool from Jenkins:

http://localhost:8080/jenkins/jnlpJars/jenkins-cli.jar

Place it in the user's home directory (mine is C:\Users\byron)

Now, create the following file, at /fakecentralrepo/demo/hooks/post-receive

------------------------ FILE START
#!/bin/sh

# the following runs the jenkins-cli command located in the user's home directory
# it uses admin as a username and admin as a password for Jenkins
# this will kick off a build on the "demo" pipeline
exec java -jar ~/jenkins-cli.jar -s http://localhost:8080/jenkins -auth admin:admin build demo
------------------------ FILE END


Now let's create a pipeline so it does some actual work.


- In Jenkins, create a pipeline, name it:  Demo      (capitalization matters here!!)
- Check the box for "discard old builds",
    Strategy: log rotation
    Max # of builds to keep: 5
- Check the box labeled "Do not allow concurrent builds".  (We don't want race conditions in our pipeline, and we don't want excessive memory usage on this demo machine)
- Check the box for "Sidebar links". Add a link.  Enter this:

  Link URL: http://localhost:8080/workspace/Demo/build/reports/bdd/cucumber-html-reports/overview-features.html
  Link Text: Cucumber report.

  Click Add Link.

  Link URL: http://localhost:9000/
  Link Text: SonarQube

  Click Add Link.

  Link URL: http://localhost:8080/workspace/Demo/build/reports/dependency-check-report.html
  Link Text: Dependency check report

  Click Add Link.

  Link URL: http://localhost:8080/demo
  Link Text: Demo

  Click Add Link

  Link URL: http://localhost:8080/workspace/Demo/build/reports/jacoco/index.html
  Link Text: Jacoco coverage report

  Click Add Link

  Link URL: http://localhost:8080/workspace/Demo/build/reports/pitest/index.html
  Link Text: Pitest Mutation Testing

  Click Add Link

  Link URL: http://localhost:8080/workspace/Demo/build/docs/javadoc/index.html
  Link Text: Javadoc

  Click Add Link

  Link URL: http://training:8080/workspace/Demo/perf_report/index.html
  Link Text: Performance report

  Click Add Link

  Link URL: http://training:8080/workspace/Demo/build/reports/zap/zap-report.html
  Link Text: Zap report

- Under Pipeline, click on the dropdown and select "Pipeline script from SCM"
- on the dropdown next to SCM, select Git.
- fill in these values:
     In Repositories:
     Repository URL: C:\Users\byron\fake_central_repo\demo  (Yours may be a different place)
     In Branches to Build:
     Branch specifier: refs/heads/master
     In Script Path: jenkins/Jenkinsfile

     Click save

Congratulations!  You should now be able to run a full pipeline.

Summary:
Jenkins is at http://localhost:8080/jenkins/
Demo is at http://localhost:8080/demo/
Sonarqube is at http://localhost:9000/



================================================
FILE: docs/ci_and_cd/install_docker_centos.txt
================================================

#######
####### Step 1 — Install Docker

#install needed packages
sudo yum install -y yum-utils device-mapper-persistent-data lvm2

#Configure the docker-ce repo:
sudo yum-config-manager -y --add-repo https://download.docker.com/linux/centos/docker-ce.repo


#Install docker-ce:
sudo yum install -y docker-ce

#Add your user to the docker group with the following command.
sudo usermod -aG docker $(whoami)

#Set Docker to start automatically at boot time:
sudo systemctl enable docker.service


#Finally, start the Docker service:
sudo systemctl start docker.service


##########
########## Step 2 - install Docker Compose

#Install Extra Packages for Enterprise Linux
sudo yum install -y epel-release


#Install python-pip

sudo yum install -y python-pip

#Then install Docker Compose:

sudo pip install docker-compose

#You will also need to upgrade your Python packages on CentOS 7 to get docker-compose to run successfully:

sudo yum upgrade -y python*

#To verify a successful Docker Compose installation, run:

docker-compose version


================================================
FILE: docs/ci_and_cd/jenkins_box_guide.txt
================================================
Console-only Jenkins, SonarQube, Git repo
-----------------------------------------

You need a few things to get started.

Download the Centos install DVD iso:
http://isoredirect.centos.org/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-1810.iso

Download the VirtualBox software:
https://www.virtualbox.org/wiki/Downloads

Go ahead and install VirtualBox using its installer.  The default
settings will suffice.

These instructions were tested using VirtualBox 6.

Prerequisite: Modify the networking configuration.
Follow ON THE HOST BOX in virtualbox_networking.txt

1. Open VirtualBox.  Click on New.  Name it "jenkinsbox".

Make sure to choose Mac osX 64 bit for the operating system.  It's not a Mac, but for
some reason this makes mouse integration work beautifully.

Click Next.

2. Give it 4096 megabytes of ram.  Click Next.

3. Keep clicking next until it gives you a choice for hard-drive size.  Set it
   to 12 gigabytes.  Click Next.

Click "settings" for the new Centos_Jenkins_machine box, do the following:
  Click on Storage and on the icon for the empty disc drive, and
  on the icon on the right, click and you should see an option to:
  "Choose Virtual Optical Disk File...".  Click that and choose the iso file
  for Centos you downloaded previously.
  
in the network tab, for adapter 1 choose Host-only adapter, and for
adapter 2 choose NAT.

  Click Ok.

Start it up.

Choose "install Centos 7" instead of "test this media and
install centos7".

Choose English for the languages.

Under system, click on "installation destination" and then click Done
on the page it opens up.  (it defaults properly)

Click on the network & Host name icon.

This is an ***important*** section.  Take it slow.

First, change the Host name to jenkinsbox.

Then, toggle the enp0s8 network adapter to ON.  That's the NAT network, so it
should just automatically work.

But let's make sure it's configured properly.  Click on Configure for it,
and Under the General tab, check the box next to "Automatically connect
to this network when it is available".  Then save it.

Select the enp0s17 network adapter.  This one we have to manually configure.  Click the
[Configure...] button in the bottom right.

Under the General tab, check the box next to "Automatically connect to this network when it is available"

Click on the IPV4 Settings tab, and change the method from automatic to manual.

Click the [Add] button.  Enter the following data:
Address:          Netmask:           Gateway:
192.168.56.101    255.255.255.0      192.168.56.1

DNS Servers: 192.168.56.1

Click on the checkbox next to "Require IPV4 addressing for this connection to complete"

Click Save.

toggle this adapter from off to on.  If done correctly, it should very quickly indicate "Connected"
with some data similar to this:
Hardware address: 08:00:27:09:16:BC
Speed 1000 Mb/s
IP Address 192.168.56.101
Subnet Mask 255.255.255.0
Default Route 192.168.56.1
DNS 192.168.56.1


Phew, done!  Click Done in the top left.

Leave the software selection at "minimal install"

Click on the "Begin Installation" button in the bottom right.

While it is installing, you will see options to set the root password
and create a user.  We're not too concerned about security, since this
box is just for educational purposes.  However, it won't let you
complete installation until you create a user.  Make a user for
yourself.  See the following...

CREATE USER DURING INSTALL
--------------------------
Click on "User Creation"

Full Name: Coveros User
User name: cuser

Enable it as an administrator user (check the
box) and make it not require a password (uncheck that box).

Click Done.

Wait for the install to finish...

Finally, it finishes, and you can click the button labeled "reboot".  Do so.

Once it finishes rebooting, you will see a console window waiting for
you to enter your username.  It should look similar to this:

---------------------------------------------------

CentOS Linux 7 (Core)
Kernel 3.10.0-957.el7.x86_64 on an x86_64

jenkinsbox login: _

---------------------------------------------------

First, log in as cuser.  You didn't set a password, so
you shouldn't need to enter a password for it.  It's an admin user, so
you can just run sudo <whatever> to act as root.

DISABLE FIREWALL
----------------

First, let's turn off the firewall and SELinux (its security system).
It's a pain in the rear, and remember, this is for educational
purposes, so security is *not* a concern.  Ease of use is.  

$ #turn off the firewall and disable it
$ sudo systemctl stop firewalld
$ sudo systemctl disable firewalld

DISABLE SELINUX
---------------

To disable SELinux, open /etc/selinux/config and set SELINUX mode to
disabled.  You can do that with an editor, or you can run this
command:

sudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config

ENABLE SSH WITH NO PASSWORD
---------------------------

Let's also change the settings on sshd (the ssh daemon) so it will
allow us to log in without a password.

sudo sed -i 's/#PermitEmptyPasswords no/PermitEmptyPasswords yes/' /etc/ssh/sshd_config

DISABLE STRICT HOST KEY CHECKING
--------------------------------

change the setting in ssh_config to not ask about host keys.  This needs to be done
because many of the conversations between our boxes will use ssh, and will halt
and ask the user if the host isn't current trusted.  Problem with that is
everything is automated, there isn't anyone to answer yes.  This should fix that.

sudo sed -i 's/#   StrictHostKeyChecking ask/StrictHostKeyChecking no/' /etc/ssh/ssh_config


now, reboot.

$ sudo reboot

You should be able to ssh into your centos box by running ssh against the url "jenkinsbox".

(if not, there may have been a mistake made when configuring the network settings.  Networking
is a real pain.)

I am using Putty, because I am on a Windows machine, but you can
use any ssh client.

Putty can be downloaded from: https://the.earth.li/~sgtatham/putty/latest/w32/putty.exe

From here on out, all commands should be run from ssh.

INSTALL JAVA
------------

$ sudo yum install java-11-openjdk-devel

INSTALL GIT
-----------

$ sudo yum -y install git

INSTALLING JENKINS
------------------

Jenkins is our tool for running continuous integration.

$ curl --silent --location http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo | sudo tee /etc/yum.repos.d/jenkins.repo
$ sudo rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key
$ sudo yum install -y jenkins
$ sudo systemctl start jenkins
$ sudo systemctl enable jenkins

(after this is done, when you are notified to update the Jenkins program, just run:

$ sudo yum update jenkins

then restart the server:

$ sudo systemctl restart jenkins

In your browser, go to Jenkins at this URL: http://jenkinsbox:8080/

Once Jenkins boots up, you will need the password for the new Jenkins, here:

$ sudo cat /var/lib/jenkins/secrets/initialAdminPassword

Copy that password and use it when prompted.  Follow the prompts, install Jenkins.
Choose "Install Suggested Plugins"

I created an admin with the following characteristics:
username: admin
password: admin
email: admin@test.com

Click Save and Continue.

Click Save and Finish.
Click Start using Jenkins

Install the Sidebar-Link plugin.  Go to:

http://jenkinsbox:8080/pluginManager/available

and search for "sidebar".  Choose Sidebar Link and Install without restart.

MAKE A GIT REPO
---------------

Now that Jenkins is up and running, let's make this same box
our Git repo, so that Git can easily notify Jenkins when it
receives a push.

Back on the ssh command line...

First, go to your home directory:

$ cd

Create a directory to store the repo:

$ mkdir demo
$ cd demo

Make a "bare" git repo:

$ git init --bare

Back in the directory where you have been working with Demo, (on the other
machine) run these commands:

the following will remove the Github origin
$ git remote remove origin

this will add your new repository location as "origin":
$ git remote add origin ssh://cuser@jenkinsbox/home/cuser/demo

this will push all your branches to that repo
$ git push --set-upstream --all origin

Now, back on the jenkinsbox command line...

make our home directory accessible by the Jenkins user:
$ chmod 775 /home/cuser

Now, we want to have the ability to notify Jenkins whenever we push
to our new repo.  Jenkins has a capability of running builds whenever
a certain endpoint is hit.  But, like all things, it's not that easy because
of security considerations.  Here's the breakdown:

CONFIGURE PIPELINE TO RUN AT GIT RECEIVE
----------------------------------------

Download the command-line-interface (CLI) tool from Jenkins:

curl http://localhost:8080/jnlpJars/jenkins-cli.jar > ~/jenkins-cli.jar

Now, create the following file, at ~/demo/hooks/post-receive

------------------------ FILE START
#!/bin/sh

exec java -jar ~/jenkins-cli.jar -s http://localhost:8080/ -auth admin:admin build demo
------------------------ FILE END

make that file executable:

$ chmod 775 ~/demo/hooks/post-receive

And now we'll try running it.  Back in the browser, in Jenkins, create a new job.  Give it
the name "Demo" and make it a "pipeline" job and click OK.

Then scroll down and click save.

You should find yourself on the Pipeline page for the "demo" project.  Back in the command
line, run this to kick off a build in Jenkins:

$ ~/demo/hooks/post-receive

You should observe a new build appear in the webpage in Jenkins.  If so, you have configured
it properly.  Whenever you push a branch, it will now run Jenkins.  That's pretty close to perfect.

Now let's modify our pipeline so it does some actual work.

- In Jenkins, on the pipeline page for Demo, click on Configure.
- Check the box for "discard old builds",
    Strategy: log rotation
    Max # of builds to keep: 5
- Check the box labeled "Do not allow concurrent builds".  (We don't want race conditions
    in our pipeline, and we don't want excessive memory usage on this demo machine)
- Check the box for "Sidebar links". Add a link.  Enter this:

  Link URL: http://jenkinsbox/reports/bdd/cucumber-html-reports/overview-features.html
  Link Text: Cucumber report.

  Click Add Link.

  Link URL: http://jenkinsbox:9000/
  Link Text: SonarQube

  Click Add Link.

  Link URL: http://jenkinsbox/reports/dependency-check-report.html
  Link Text: Dependency check report

  Click Add Link.

  Link URL: http://jenkinsbox/reports/zap_report.html
  Link Text: Zap security report

- Under Pipeline, click on the dropdown and select Pipeline script from SCM.
- on the dropdown next to SCM, select Git.
- fill in these values:
     In Repositories:
     Repository URL: /home/cuser/demo
     In Branches to Build:
     Branch specifier: refs/heads/master
     In Script Path: jenkins/Jenkinsfile

     Click save

We're not quite done yet, we need to install some other parts of our system
before this will all work.  Now that our Jenkins pipeline is running, and
we have a Git repo, and we have a database running, let's throw in another application - SonarQube!

INSTALL SONARQUBE
-----------------

download it to your home directory:

$ curl https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-8.0.zip > ~/sonarqube-8.0.zip

install the unzip command:

$ sudo yum install -y unzip

make a new directory and unzip it to there
(importantly, don't do this as root.  It will fail):

$ mkdir ~/sonarqube
$ sudo unzip ~/sonarqube-8.0.zip -d ~/sonarqube/

move the directory to opt:

$ sudo mv ~/sonarqube/sonarqube-8.0 /opt/sonarqube

create a sonarqube user:

$ sudo adduser sonarqube

change the ownership of the sonarqube directory to sonarqube's user:

$ sudo chown -R sonarqube:sonarqube /opt/sonarqube

Create the file /etc/systemd/system/sonar.service with this content:

------------------------------- FILE START
[Unit]
Description=SonarQube service
After=syslog.target network.target

[Service]
Type=simple
User=sonarqube
Group=sonarqube
PermissionsStartOnly=true
ExecStart=/bin/nohup /bin/java -Xms32m -Xmx32m -Djava.net.preferIPv4Stack=true -jar /opt/sonarqube/lib/sonar-application-8.0.jar
StandardOutput=syslog
LimitNOFILE=65536
LimitNPROC=8192
TimeoutStartSec=5
Restart=always

[Install]
WantedBy=multi-user.target

------------------------------- FILE END

Start Sonarqube and register it to start at boot:

$ sudo systemctl start sonar
$ sudo systemctl enable sonar

You can view the logs for Sonarqube running at /var/log/messages.  It will take
a few minutes, but watch to see if Sonarqube is up and running.

(wait... and.. )

go to http://jenkinsbox:9000/about and check if you see the Sonarqube dashboard.

If that is up and running, let's go back to Jenkins and install a
plugin so we can run SonarQube on our code from there.  Go to:

http://jenkinsbox:8080/pluginManager/available

and search for Sonarqube in the top right.  You should see "SonarQube scanner"
as an option.  Check that on, then Install without restart.


INSTALL WEB SERVER
------------------

create and edit a new file at /etc/yum.repos.d/bintray-tatsushid-h2o-rpm.repo

-------------------- FILE START
#bintray-tatsushid-h2o-rpm - packages by tatsushid from Bintray
[bintray-tatsushid-h2o-rpm]
name=bintray-tatsushid-h2o-rpm
baseurl=https://dl.bintray.com/tatsushid/h2o-rpm/centos/$releasever/$basearch/
gpgcheck=0
repo_gpgcheck=0
enabled=1
--------------------- FILE ENDS

install it:
$ sudo yum install -y h2o

Once the installation finishes successfully, you can see a
configuration file at /etc/h2o/h2o.conf

Edit that file, make it as follows.

("file.dirlisting: ON" means that if you go to the URL
without specifying a page, it will show you the contents of the directory.)

-------------------------------------- FILE START
user: cuser
file.dirlisting: ON
hosts:
  "localhost:80":
    listen:
      port: 80
      host: 0.0.0.0
    paths:
   paths:
      "/reports":
        file.dir: /var/lib/jenkins/workspace/demo/build/reports/
access-log: /var/log/h2o/access.log
error-log: /var/log/h2o/error.log
pid-file: /var/run/h2o/h2o.pid
-------------------------------------- FILE END

The value in file.dir is meant to point to the place where we are storing the
output of our Cucumber report generation.  This way, you can view the status of
your BDD tests.

To start h2o:

$ sudo systemctl enable h2o.service
$ sudo systemctl start h2o.service

CUSTOMIZE HOSTS FILE
--------------------

Edit /etc/hosts and add a new entry to point to uitestbox:

192.168.56.102 uitestbox


CONGRATULATIONS!!!!  You're done with building the Jenkins box.  Now go over to the
document to build the ui_test_box.



================================================
FILE: docs/ci_and_cd/ssl.txt
================================================
Setting up Tomcat to use certificates

https://stackoverflow.com/a/41366949/713809
openssl req -x509 -newkey rsa:4096 -sha256 -days 8000 -nodes -keyout training.key -out training.crt -subj "/CN=training" -addext "subjectAltName=DNS:training,IP:10.0.0.1"

(Note that 8000 in the command above means 8000 days, which should keep us in business for a while)

https://tomcat.apache.org/tomcat-9.0-doc/ssl-howto.html#Configuration
openssl pkcs12 -export -in training.crt -inkey training.key -out training.p12 -name tomcat -CAfile training.crt -caname root -chain

when running this command, it will ask you for a password:
"Enter Export Password:"

(I used 3Qzyge7H31QavDANTUL3hY0d)

Whatever you enter there, you will include as the passowrd in server.xml:
    <Connector port="8443" protocol="org.apache.coyote.http11.Http11NioProtocol"
               maxThreads="200" SSLEnabled="true"
			   scheme="https" secure="true"
			   keystoreFile="${user.home}/training.p12" keystorePass="3Qzyge7H31QavDANTUL3hY0d"
			   clientAuth="false" sslProtocol="TLS"
			   >

Once that is done, go to https://localhost:8443 in Chrome and it will complain about insecurity.  Click advanced
and go to the "unsafe" site.  When you get there, it is possible to click on the icon to the left of the URL to
get details about the cert.  On the second tab there, click on copy to file, use the default .der configuration
and save it to the desktop as cert.der

Double-click on that file on the desktop and click on Install Certificate.  Choose local machine, place all certificates
in the following store, browse, and choose Trusted Root Certification Authorities.

Restart Chrome, and try to connect to https://localhost:8443, it should work fine now.


================================================
FILE: docs/ci_and_cd/ui_test_box.txt
================================================
making a box for UI-level testing

(First create the Jenkins box.  See jenkins_box_guide.txt, then come back)

In VirtualBox, click on New.

Create a new system "uitestbox"

Make sure to choose Mac osX 64 bit for the operating system.  It's not a Mac, but for
some reason this makes mouse integration work beautifully.

Set it to use 6144 megabytes of ram and 12 gigs hard drive.

Alter its settings:
  in the network tab, for adapter 1 choose Host-only adapter, and for
  adapter 2 choose NAT.
  Put the CentOS7 disc in the virtual drive.

Start the server.

Choose to install Centos7.  (No need to check the media first)

Choose English as the language
Click Installation Destination and click Done on the followup screen to return

Click on the network & Host name icon.

This is an ***important*** section.  Take it slow.

First, change the Host name to uitestbox.

Then, toggle the enp0s8 network adapter to ON.  That's the NAT network, so it
should just automatically work.

But let's make sure it's configured properly.  Click on Configure for it,
and Under the General tab, check the box next to "Automatically connect
to this network when it is available".  Then save it.

Select the enp0s17 network adapter.  This one we have to manually configure.  Click the
[Configure...] button in the bottom right.

Under the General tab, check the box next to "Automatically connect to this network when it is available"

Click on the IPV4 Settings tab, and change the method from automatic to manual.

Click the [Add] button.  Enter the following data:
Address:          Netmask:           Gateway:
192.168.56.102    255.255.255.0      192.168.56.1

DNS Servers: 192.168.56.1

Click on the checkbox next to "Require IPV4 addressing for this connection to complete"

Click Save.

toggle this adapter from off to on.  If done correctly, it should very quickly indicate "Connected"
with some data similar to this:
Hardware address: 08:00:27:09:16:BC
Speed 1000 Mb/s
IP Address 192.168.56.102
Subnet Mask 255.255.255.0
Default Route 192.168.56.1
DNS 192.168.56.1

Phew, done!  Click Done in the top left.

Click Software selection and choose KDE Plasma Workspaces, then click Done.  After
doing that, it can take a while for the system to be done processing.  Wait.

Click Begin Installation

While it is installing, you will see options to set the root password
and create a user.  We're not too concerned about security, since this
box is just for educational purposes.  However, it won't let you
complete installation until you create a user.  Make a user for
yourself.  See the following...

CREATE USER DURING INSTALL
--------------------------
Click on "User Creation"

Full Name: Coveros User
User name: cuser

Enable it as an administrator user (check the
box) and make it not require a password (uncheck that box).

Click Done.

Wait for the install to finish...

... wait for the install to complete...

... keep waiting...

click on reboot.

Click on Licensing.  Accept.  Click Done.  Click Finish Installation.

Login.

Turn off the power saving feature (which would blank our screen).  Click the icon on
the bottom left and search for "energy", then click on Energy Saving.  Uncheck the box
for Screen Energy Saving on all tabs - AC Power, Batter, Low Battery.  In Battery and Low
Battery, uncheck "Suspend Session"

Right-click the screen and click on Konsole to get a command-line terminal.

DISABLE FIREWALL
----------------

First, let's turn off the firewall and SELinux (its security system).
It's a pain in the rear, and remember, this is for educational
purposes, so security is *not* a concern.  Ease of use is.

$ #turn off the firewall and disable it
$ sudo systemctl stop firewalld
$ sudo systemctl disable firewalld

DISABLE SELINUX
---------------

To disable SELinux, open /etc/selinux/config and set SELINUX mode to
disabled.  You can do that with an editor, or you can run this
command:

sudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config

ENABLE SSH WITH NO PASSWORD
---------------------------

Let's also change the settings on sshd (the ssh daemon) so it will
allow us to log in without a password.

sudo sed -i 's/#PermitEmptyPasswords no/PermitEmptyPasswords yes/' /etc/ssh/sshd_config

DISABLE STRICT HOST KEY CHECKING
--------------------------------

change the setting in ssh_config to not ask about host keys.  This needs to be done
because many of the conversations between our boxes will use ssh, and will halt
and ask the user if the host isn't current trusted.  Problem with that is
everything is automated, there isn't anyone to answer yes.  This should fix that.

sudo sed -i 's/#   StrictHostKeyChecking ask/StrictHostKeyChecking no/' /etc/ssh/ssh_config

now, reboot.

Now you can connect to your uitestbox by SSH.
Do the rest of this in ssh by connecting to "uitestbox"

Install Chrome:

 $ sudo yum install -y wget
 $ wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm
 $ sudo yum localinstall -y google-chrome-stable_current_x86_64.rpm

Start Chrome by selecting it from the bottom left-hand button and entering
the text "Chrome", then click on the icon.  Choose a means of securing information,
(I used Classic, blowfish encrypted file because it was easier to set up.  Remember,
you aren't doing anything on this box but UI testing)
and get through until you see the chrome://welcome page.  Test it by going to Google.com

INSTALL JAVA
------------

$ sudo yum -y install java-11-openjdk-devel

INSTALL GIT
-----------

$ sudo yum -y install git


INSTALL PYTHON 3
----------------

$ sudo yum install -y gcc openssl-devel bzip2-devel libffi-devel
$ wget https://www.python.org/ftp/python/3.7.0/Python-3.7.0.tgz
$ tar xzf Python-3.7.0.tgz
$ cd Python-3.7.0
$ ./configure --enable-optimizations
$ sudo make altinstall

INSTALL PIP
-----------

$ curl https://bootstrap.pypa.io/get-pip.py -o ~/get-pip.py

INSTALL PYTHON ENVIRONMENT
---------------------------

$ sudo /usr/local/bin/python3.7 ~/get-pip.py
$ sudo /usr/local/bin/pip3.7 install pipenv

Download Chromedriver from here: http://chromedriver.chromium.org/downloads.  At the
time of writing this, the URL went as follows:

$ curl https://chromedriver.storage.googleapis.com/2.45/chromedriver_linux64.zip > ~/chromedriver_linux64.zip

Download and unzip it on your path.  I recommend a place that is
already on your path, /usr/local/sbin

$ sudo unzip ~/chromedriver_linux64.zip -d /usr/local/sbin


install Tomcat 9:

$TOMCAT_URL = figure out where to download tomcat from: https://tomcat.apache.org/download-90.cgi
$TOMCAT_FILE_NAME = the name of the tomcat file

for example:
$ wget http://www.gtlib.gatech.edu/pub/apache/tomcat/tomcat-9/v9.0.14/bin/apache-tomcat-9.0.14.tar.gz
$ tar zxf apache-tomcat-9.0.14.tar.gz
$ sudo mv apache-tomcat-9.0.14 /opt/tomcat
$ sudo useradd -r tomcat --shell /bin/false
$ sudo chown -R tomcat:tomcat /opt/tomcat/

at /etc/init.d/tomcat9 create this file:


---------------------------------- FILE START
#!/bin/sh
#
### BEGIN INIT INFO
# Provides:          tomcat9
# Required-Start:    $local_fs $remote_fs $network
# Required-Stop:     $local_fs $remote_fs $network
# Should-Start:      $named
# Should-Stop:       $named
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Start Tomcat.
# Description:       Start the Tomcat servlet engine.
### END INIT INFO

PATH=/bin:/usr/bin:/sbin:/usr/sbin
NAME=tomcat9
DESC="Tomcat servlet engine"
CATALINA_HOME=/opt/tomcat

if [ `id -u` -ne 0 ]; then
  echo "You need root privileges to run this script"
  exit 1
fi


case "$1" in
  start)
    sudo -utomcat $CATALINA_HOME/bin/startup.sh
    sleep 5
    ;;
  stop)
    sudo -utomcat $CATALINA_HOME/bin/shutdown.sh
    ;;
esac

---------------------------------- FILE END

Change its permissions
$ sudo chmod 755 /etc/init.d/tomcat9

Add it to chkconfig

$ sudo chkconfig tomcat9 on

Now you can start the Apache Tomcat 9 server and enable it to start on boot time

$ sudo systemctl start tomcat9
$ sudo systemctl enable tomcat9

Tomcat will start serving on port 8080 on the machine.

INSTALLING OWASP-ZAP
--------------------
$ wget https://download.opensuse.org/repositories/home:cabelo/CentOS_7/home:cabelo.repo
$ sudo mv home:cabelo.repo /etc/yum.repos.d/home_cabelo.repo
$ sudo yum install -y owasp-zap

Start zap like Chrome - go to the icon in the bottom left of the screen and search
for Zap.  When it appears, click it.  You'll need to accept the agreement to continue.

Choose *not* to persist the ZAP session, and check the box to remember the choice.  Then
Click on Start.

On the menu bar, under Help, click on "Check for updates..." and update as suggested.

Change the port number so it doesn't interfere with our demo application:

Open ZAP, Tools--> Options --> local proxies
Change the default 8080 port to 8888 and click Ok.

Configure Zap to run as a proxy at boot:

edit /etc/systemd/system/zap.service:

-------------- FILE START ------------------------
[Unit]
Description=Zap security proxy
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=always
RestartSec=1
User=cuser
ExecStart=/usr/share/owasp-zap/zap.sh -daemon -config api.disablekey=true

[Install]
WantedBy=multi-user.target
-------------- FILE END ------------------------

By the way, details on creating your own systemd script can be found here: https://medium.com/@benmorel/creating-a-linux-service-with-systemd-611b5c8b91d6

In order to test out Zap, in the Quick Start tab, enter the following URL

URL to attack: http://localhost:8080/demo

Then, click Attack.

To do the same thing from the command line, run this:

/usr/share/owasp-zap/zap.sh -cmd -quickurl http://localhost:8080/demo


CUSTOMIZE HOSTS FILE
--------------------

edit the /etc/hosts and add a new entry to point to jenkinsbox:

192.168.56.101 jenkinsbox



================================================
FILE: docs/ci_and_cd/virtualbox_networking.txt
================================================
Networking on the virtual machines and the host.
------------------------------------------------

The boxes will use NAT (for regular internet) as interface 1,
and Host-Only as 2 (so we can have a conversation between the host and guests)

ON THE HOST BOX
---------------

Configure the Host-only network (on Windows, it is
named VirtualBox Host-Only Network #2, by default).

Edit the ipv4 settings and configure them as follows:

IP address: 192.168.56.2
Subnet mask: 255.255.255.0
Default gateway: 192.168.56.1

Use the following DNS server addresses:
Preferred DNS server: 192.168.56.1

edit hosts (on Windows, it's at C:\Windows\System32\drivers\etc\hosts ) and add:

192.168.56.101 jenkinsbox
192.168.56.102 uitestbox

ON THE GUEST MACHINE
------------------------------------

(the following may be helpful information if there is
an issue with the network after install is complete.  Otherwise,
this is all optional)


On the console in the jenkinsbox, I used nmtui:

$ nmtui

Edit a connection.
(It may have been necessary to create one.  If so, here are the details.
The only thing to note is that you should change the value of the "Addresses"
field - make jenkinsbox 192.168.56.101 and make uitestbox 192.168.56.102:

Profile name: host-only network
Device: 08:00:27:22:04:D9 (enp0s8)

Ethernet
IPv4 configuration <Manual>
Addresses: 192.168.56.101/24
Gateway: 192.168.56.1
DNS Server: 192.168.56.1

At the bottom, select [X] Automatically connect

Then click ok.



================================================
FILE: docs/dev_notes/README.txt
================================================
architecture.txt                  : Architectural notes of the application
monitoring_tomcat.txt             : How to monitor Tomcat with JConsole.
pre-push                          : a Git hook to run tests before pushing to a remote repo.
README_db.txt                     : Some details about the database we're using in Demo.


================================================
FILE: docs/dev_notes/architecture.txt
================================================
Architecture summary
--------------------

This is a web application with server-side rendering, used as an educational tool to discuss aspects of quality.
Database:  H2
Server: Tomcat.

Endpoints
---------

For endpoints (access to the functionality from the outside world, aka its web API), look for files
ending in the word "Servlet".

In those files, the class has annotation which includes text like this:

    urlPatterns = {"/ackermann"}

The value of the urlPattern, in this case "ackermann", designates the url that is exposed to the
outside world.  In this case, the URL for the endpoint would be:

    demo/ackermann


Persistence
-----------

The database is solely accessed from the file PersistenceLayer.java

This project uses FlywayDB https://flywaydb.org/
FlywayDB is a database migration tool - an application that runs scripts against our database
to set it into a clean and organized state.  This allows us certain benefits when working with
our database, such as:

 - It provides a more organized approach to changing the schema of the database
 - Allows for better testing of the database
 - Allows for carefully vetted changes to the database


Business functionality
----------------------

Most of the business functionality is stored in files ending with "Utils".


Avoidance of null
-----------------

Throughout this application, it was attempted to avoid null.  Null is fine and all,
but it has a problem: null is too vague a description, and it's too easy to forget to
handle the situation when something comes back null.

1) if I request a "user" from the database, and I get null ... what does that mean? Does
it mean there was no user?  That there was an error? Who knows.

2) In Java, a lot of methods return an object, and oftentimes it returns null, and it's
just so painfully easy to forget to handle what happens when it's null.


Immutability
------------

Immutable data structures are easier to track.  The basic problem with immutability
is that when it is possible for a certain data structure to be changed after creation,
it's just too easy to do so.  When a structure's state can easily change, and the code
has any parallelization or event-driven code, trying to be certain of the code's behavior
becomes quite a bit more difficult.

When we create a data structure, we favor doing so immutably - that is, once created, it cannot
be changed.  To make a change, we have to recreate the data structure.


Packages
--------

The packages are divided up by domain.  For example, the majority of code for the library is
in com.coveros.training.library.


Testing
-------

Good testing from a sincere quality perspective is crucial for high-quality applications.
There are all kinds of testing, for all kinds of quality considerations.  For example, do
you care about internal quality?  There are a number of frameworks you can apply to keep
you honest about that.  Do you care about correct functioning at the granular level? Unit
tests (especially following TDD) help out there.  What about making sure that business
requirements are carefully met?  We include BDD for that purpose - see the files in
src/bdd_test.  We also include a Jenkinsfile (called "Jenkinsfile")  for use with
Jenkins (https://www.jenkins.io/) which is a CI/CD tool.  Jenkins runs a huge slew of
tests which examine many aspects of the program, including non-functionals like
security and performance testing.


================================================
FILE: docs/dev_notes/monitoring_tomcat.txt
================================================
To monitor Tomcat with JConsole:
--------------------------------

First, in the /opt/tomcat/bin directory, add a file "setenv.sh"

Here are the contents:

export CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=uitestbox";

make sure it has the proper ownership and permissions:

$ sudo chown tomcat:tomcat setenv.sh
$ sudo chmod 750 setenv.sh

restart Tomcat, and you will be able to access it from JConsole on port 9999

$ sudo systemctl restart tomcat9





================================================
FILE: docs/dev_notes/pre-push
================================================
#!/bin/sh

# This is a file meant to be run just before we push our work to
# a remote repository.  It runs the basic set of tests, just to make
# sure that things are generally valid before sending.

# To install this, put it into the git directory under hooks

# this program is expected to be run just before pushing the application to
# a remote repository.  Since that action is rare compared to commits, and because
# we want to be doubly sure of our work before sending it out, we will run
# the gradlew check command.  If that fails, we want to correct things first.

# stash all changes, including what is in the index (the staging area between
# the working directory and the repository).  This is so that when we run our
# tests, we are only testing the stuff that's fully committed to the repo
# and that is going to be sent to the central repo, since this is pre-push

git stash push -q

# run the tests with the gradle wrapper
./gradlew check

# store the last exit code in a variable
RESULT=$?

# unstash the stashed changes
git stash pop -q

# return the './gradlew check' exit code
exit $RESULT



================================================
FILE: docs/dev_notes/README_db.txt
================================================
The database we are using in the project is H2.  It's perfect for our
purposes for the following reasons:

* Stable and widely used
* Small - no install needed, can be pulled in as a dependency
* Can use Postgresql SQL syntax, so switching to Postgresql wouldn't be too hard
* Comes with all the tools you need, including a web-based db viewer

Nevertheless, there are subtleties to using H2. For example, we use it
in both in-memory and file-based modes.  

We use file-based when we need something persistent between processes.
When Tomcat is running, its process keeps going and we can access its
data through a web app on that same Tomcat.  However if we run unit
tests, the JUnit runner will wrap up and all the data is lost.  If we
want to manipulate data related to a particular test, or to create
backups of new test data, this is the easiest way.

The issue with file-based database is simple - where do we store the
database?  Users will be using this application on multiple
architectures and in multiple scenarios.  If we are running on Tomcat
and use in-memory, we simply don't have to worry about where the
database file is located.

If we are running unit tests, the database file is located in
build/db/training.mv.db



================================================
FILE: docs/performance_testing/README.txt
================================================
50_users_at_once.jmx              : A Jmeter file simulating 50 simultaneous users.
demo.jmx                          : A JMeter file to demonstrate performance testing.
perf_testing_with_jmeter.txt      : Some notes to help testing performance with JMeter.




================================================
FILE: docs/performance_testing/perf_testing_with_jmeter.txt
================================================
Demonstrating Performance testing with JMeter
---------------------------------------------

Installing Jmeter
-----------------
First and foremost, have Jmeter installed: https://jmeter.apache.org/download_jmeter.cgi
Then, install plugin manager: https://jmeter-plugins.org/wiki/PluginsManager/
  Installing plugin manager is described on the plugin's page:
  Download the Plugins Manager JAR file and put it into JMeter's lib/ext directory.
  Then start JMeter and go to "Options" menu to access the Plugins Manager.

Open up JMeter.

Open docs/demo.jmx

Open Java Mission Control (jmc) and connect to uitestbox:9999

Open putty to uitestbox and tail -f the logs/catalina.out in Tomcat

Run the test.
You should see quite a lot of action in the Tomcat logs.  While the test is running, take a look at the graphs.

One interesting thing to note is that at a certain point, close to about 80 users, the CPU starts to
max out.  At that point the response time starts going through the roof.



Alternative:
-----------

Window 1:
Prepare command line: java -jar PATH/TO/ApacheJMeter.jar -n --testfile demo.jmx

Window 2:
Open Oracle Java Mission Control (JMC)

Window 3:
Open the log file for Tomcat

Window 4:
Prepare to open the jmeter.log log file to tail it.



In JMC, show the views that show memory and cpu.  Make that clear on
the screen.

Make the logging clearly visible - move the window around to suit.

Show the Jmeter listener graph of thoroughput.


Configuring JMeter for reports
------------------------------
There's great information on the built-in report generator, at:

https://www.ubik-ingenierie.com/blog/reporting-feature-in-jmeter/

I changed a couple settings in the bin/user.properties file:

The granularity of graphs in millis (defaults to one minute):

jmeter.reportgenerator.overall_granularity=1000

The transactions you want in report:

jmeter.reportgenerator.exporter.html.series_filter=^(Search|Order)(-success|-failure)?$

You can use a helper menu to generate this last property from your plan,
Help > Export transactions for report


================================================
FILE: docs/security_testing/README.txt
================================================
zap_proxy_security_scanning.txt   : Setting up Zap to run as a proxy on the UI test server


================================================
FILE: docs/security_testing/zap_proxy_security_scanning.txt
================================================
Zap proxy for UI tests
----------------------

It's an excellent idea to have a security scanning proxy to run your UI and API tests through.  What will
happen is that the scanner will inspect everything about each request and response, and will then
be able to notify you of any issues it sees during the run.

(This assumed you have configured Zap to listen on port 9888)

In environment.py, add this import:

from selenium.webdriver.common.proxy import Proxy, ProxyType

and replace __open_browser with this:

def __open_browser(context):
    PROXY = "localhost:9888"

    proxy = Proxy()
    proxy.proxy_type = ProxyType.MANUAL
    proxy.http_proxy = PROXY
    proxy.socks_proxy = PROXY
    proxy.ssl_proxy = PROXY

    capabilities = webdriver.DesiredCapabilities.CHROME
    proxy.add_to_capabilities(capabilities)

    context.driver = webdriver.Chrome(desired_capabilities=capabilities)

Now, run Zap.

Finally, run the tests.  It will run them through that proxy and you will get a report of what it sees.


================================================
FILE: docs/ui_testing/README.txt
================================================
README_python.txt                 : Necessary instructions for getting Demo set up to run Python.
chromedriver_log.zip              : A compressed log file from Chromedriver when running our Behave UI tests
python_selenium_cheat_sheet.txt   : A cheat-sheet for driving Selenium with Python.
python_selenium_walkthrough.txt   : A walkthrough of using Selenium with Python.


================================================
FILE: docs/ui_testing/desktop_automation.txt
================================================
How to create robust application automation
-------------------------------------------

In web applications, it is possible to test using locators of our elements - locating
a particular text field or a button, then interacting with it.

Sometimes our software isn't a web application.  How do you test that?

Some of the automation frameworks for applications attempt to mimic the behavior of a
human - moving the mouse to a known position on the screen and clicking, sending
characters like a human would have done on a keyboard, and so on.

The problem with that: it results in incredibly fragile tests that require tremendous
maintenance.

Just imagine that the screen size changed.  Suddenly all the tests would be invalid,
with mouse clicks going who-knows-where.  What if the styling of the user interface
changed at all?  What a pain it would be to figure out why things weren't working
perfectly.

A much better way is to plan for automation from the start.  Yes, the developers would
have to spend extra time to develop some kind of system to enable automated testing,
but if they are on-board with the idea that testable systems lead to more tests
which leads to higher quality, then they have to understand it is an investment
worth making.

A current project with Demo is to provide this kind of robust automation for a
desktop UI application.

To start the application:
   gradlew startui

To start the scripting client:
   gradlew startscriptclient

Once they have both started, you can run commands in the script client as follows:

commands possible:
    set label <TEXT>
    set age <AGE>
    set claims <CLAIMS>

    get label
    get age
    get claims

    click calculate

    quit - quits the test script client
    close - closes down the claims application


Note: this is all still at a very rudimentary stage.


================================================
FILE: docs/ui_testing/python_selenium_cheat_sheet.txt
================================================
UI automation cheatsheet with Python and Selenium

start with these:
	from selenium import webdriver
	from selenium.webdriver.common.keys import Keys
	from hamcrest import *

to open the browser:
	driver = webdriver.Chrome()

to open a page:
	driver.get("http://localhost:8888/demo")

to select by id:
	driver.find_element_by_id("login_username")

to select using CSS:
	driver.find_element_by_css_selector("#foo")

to close the browser:
	driver.close()



actions 
-------

In all the following actions, it's assumed we have assigned
some element on the page to the "element" variable.  For example:
element = driver.find_element_by_id("login_submit")

check
	assert_that(title, contains_string('Registered Page'))

clear contents of input:
	element.clear()

click
	element.click()
	
type
	element.send_keys("somepass")
	
doubleclick
	element.double_click()
	
hover
	hover = ActionChains(firefox).move_to_element(element_to_hover_over)
	hover.perform()

keydown
	(to press ctrl+c)
	ActionChains(driver).key_down(Keys.CONTROL).send_keys('c').key_up(Keys.CONTROL).perform()
	
goback
	driver.back()
	
delete all visible cookies
	driver.delete_all_cookies()


================================================
FILE: docs/ui_testing/python_selenium_walkthrough.txt
================================================
See README.txt for preliminaries


Let's start by running our application locally, as something to test.

In a terminal window, start up the application.  In the home directory for this application, run this:
on Windows:
	gradlew apprun
on Mac/Linux:
	./gradlew apprun
	
It should return a message like this:
	$ gradlew apprun
  17:10:53 INFO  Tomcat 8.0.53 started and listening on port 8080
  17:10:53 INFO  demo runs at:
  17:10:53 INFO    http://localhost:8080/demo


Open another terminal.  Run the pipenv shell:

  pipenv shell

Then, run python:

  python

You should see something like this:
	Python 3.7.0 (v3.7.0:1bf9cc5093, Jun 27 2018, 04:06:47) [MSC v.1914 32 bit (Intel)] on win32
	Type "help", "copyright", "credits" or "license" for more information.
	>>>

Now, let's start typing some commands.
First, the boilerplate stuff so we have access to the commands we'll need:
	from selenium import webdriver
	from selenium.webdriver.common.keys import Keys
	from hamcrest import *
	
Those shouldn't return any response.  If there are errors indicated, take another look and make sure
you typed it correctly and that dependencies are resolved (you need Selenium installed for these commands to work).

Now, let's open up Chrome.
	driver = webdriver.Chrome()
	
If this went well, you should see a Chrome browser open up, and a message in your terminal
about devtools listening.  Otherwise you should see an error message in your terminal.  Make sure you
have installed Chromedriver in your path before running these commands.

Let's tell Selenium to go to our application:

	driver.get("localhost:8080/demo/library.html")
	
You should see that page show up in the browser, if you did that right.

Let's get some information about the page, like it's title.  Easy:

	>>> driver.title
	'Library'
	
Let's assert that:

	assert_that(driver.title, contains_string('Library'))

This should return nothing, indicating success.  Let's try it with something that's not there:

	>>> assert_that(driver.title, contains_string('foo'))
	...
  AssertionError:
  Expected: a string containing 'foo'
       but: was 'Web Demo'

Ah!  an error returned.
	
Let's try out adding some text to a field.  The first thing we have to do is
select the field.  There are various ways to do this, but just to jump ahead,
here's the way to select the input for the login username, and assign it to a
variable called "login_username_field"

	login_username_field = driver.find_element_by_id("login_username")
	
If that worked correctly, you shouldn't see any message returned.  We can see if we caught the element by simply typing the variable name:

	login_username_field

Which should return something like this:
<selenium.webdriver.remote.webelement.WebElement (session="5a75e46839b143d536a462131339ebcc", element="0.5216071359417056-1")>	

Let's add some text to that field:

	login_username_field.send_keys("someuser")
	
You should see the text "someuser" appear in the login username field.

Let's repeat these commands for the password field in the login form.

select the input for the login form password, and assign it to a variable called "login_password_field"

	login_password_field = driver.find_element_by_id("login_password")

Let's add some text to that field:

	login_password_field.send_keys("somepass")
	
You should see the text "********" appear in the login password field.

Now we've simulated the actions of a user typing in their username and password on a
page.  Let's try the final step, clicking on the login button.

Several of the following steps are going to seem familiar at this point.  But let's
step through them slowly and carefully.

login_button = driver.find_element_by_id("login_submit")

Now, we're going to send a click to that button:

login_button.click()

This should cause your browser to jump to another page.  In all likelihood you will
see "access denied" on the page.

Now explore around.  See python_selenium_cheat_sheet.txt for a breakdown of
common commands.


================================================
FILE: docs/ui_testing/README_python.txt
================================================
We need a few things installed before continuing here.

First, you will need Python 3.7 for your system.
Next you will need pipenv, a tool that makes it easy to get the dependencies you need.

To get pipenv:

first download get-pip.py from https://bootstrap.pypa.io/get-pip.py, and run

    python get-pip.py

Then,

    pip install pipenv

And in the demo directory,

    pipenv install

In order to run the Selenium tests with these instructions, you need Chrome and a driver for the browser.
Download Chromedriver (check http://chromedriver.chromium.org/) and make sure it's in your path or in the ui_tests directory.



================================================
FILE: docs/ui_testing/running selenium_grid.txt
================================================
To get Selenium grid: https://www.seleniumhq.org/download/


To run the hub:
---------------
java -jar selenium-server-standalone-<VERSION>.jar -role hub

To run the Chrome node:
-----------------------
java -jar selenium-server-standalone-<VERSION>.jar -role node -hub http://localhost:4444/grid/register -browser browserName=chrome,maxInstances=5

To run the Firefox node:
------------------------
java -jar selenium-server-standalone-<VERSION>.jar -port 5556 -role node -hub http://localhost:4444/grid/register -browser browserName=firefox,maxInstances=3

To run the Edge node:
---------------------
java -jar selenium-server-standalone-<VERSION>.jar -port 5557 -role node -hub http://localhost:4444/grid/register -browser browserName=edge,maxInstances=1


In order for Selenified to pay attention to the grid running locally, it is necessary to change its configuration.

In selenified.properties:
  hub=http://localhost:4444
  browser=Firefox,Chrome,Edge

Also, make sure that the webdrivers are available on the path:
  Chromedriver
  Geckodriver
  Webdriver for Edge

run:  gradlew selenified





================================================
FILE: gradle/wrapper/gradle-wrapper.properties
================================================
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-7.0-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists



================================================
FILE: jenkins/Jenkinsfile
================================================
// This jenkinsfile is used to run CI/CD on my local (Windows) box, no VM's needed.

pipeline {

  agent any

   environment {
        // This is set so that the Python API tests will recognize it
        // and go through the Zap proxy waiting at 9888
        HTTP_PROXY = 'http://127.0.0.1:9888'
   }

  stages {

    // build the war file (the binary).  This is the only
    // place that happens.
    stage('Build') {
      steps {
        sh './gradlew clean assemble'
      }
    }

    // run all the unit tests - these do not require anything else
    // to be running and most run very quickly.
    stage('Unit Tests') {
      steps {
        sh './gradlew test'
      }
      post {
        always {
          junit 'build/test-results/test/*.xml'
        }
      }
    }

    // run the tests which require connection to a
    // running database.
    stage('Database Tests') {
      steps {
        sh './gradlew integrate'
      }
      post {
        always {
          junit 'build/test-results/integrate/*.xml'
        }
      }
    }

    // These are the Behavior Driven Development (BDD) tests
    // See the files in src/bdd_test
    // These tests do not require a running system.
    stage('BDD Tests') {
      steps {
        sh './gradlew generateCucumberReports'
        // generate the code coverage report for jacoco
        sh './gradlew jacocoTestReport'
      }
      post {
          always {
            junit 'build/test-results/bdd/*.xml'
          }
        }
    }

    // Runs an analysis of the code, looking for any
    // patterns that suggest potential bugs.
    stage('Static Analysis') {
      steps {
        sh './gradlew sonarqube'
        // wait for sonarqube to finish its analysis
        sleep 5
        sh './gradlew checkQualityGate'
      }
    }


    // Move the binary over to the test environment and
    // get it running, in preparation for tests that
    // require a whole system to be running.
    stage('Deploy to Test') {
      steps {
      sh './gradlew deployToTestWindowsLocal'
      // pipenv needs to be installed and on the path for this to work.
      sh 'PIPENV_IGNORE_VIRTUALENVS=1 pipenv install'

      // Wait here until the server tells us it's up and listening
      sh './gradlew waitForHeartBeat'

      // clear Zap's memory for the incoming tests
      sh 'curl http://zap/JSON/core/action/newSession -s --proxy localhost:9888'
      }
    }


    // Run the tests which investigate the functioning of the API.
    stage('API Tests') {
      steps {
        sh './gradlew runApiTests'
      }
      post {
        always {
          junit 'build/test-results/api_tests/*.xml'
        }
      }
    }

    // We use a BDD framework for some UI tests, Behave, because Python rules
    // when it comes to experimentation with UI tests.  You can try things and see how they work out.
    // this set of BDD tests does require a running system.
    // BDD at the UI level is just to ensure that basic capabilities work,
    // not that every little detail of UI functionality is correct.  For
    // that purpose, see the following stage, "UI Tests"
    stage('UI BDD Tests') {
      steps {
        sh './gradlew runBehaveTests'
        sh './gradlew generateCucumberReport'
      }
      post {
        always {
          junit 'build/test-results/bdd_ui/*.xml'
        }
      }
    }

    // This set of tests investigates the functionality of the UI.
    // Note that this is separate fom the UI BDD Tests, which
    // only focuses on essential capability and therefore only
    // covers a small subset of the possibilities of UI behavior.
    stage('UI Tests') {
        steps {
            sh 'cd src/ui_tests/java && ./gradlew clean test'
        }
        post {
            always {
                junit 'src/ui_tests/java/build/test-results/test/*.xml'
            }
        }
    }

    // Run OWASP's "DependencyCheck". https://owasp.org/www-project-dependency-check/
    // You are what you eat - and so it is with software.  This
    // software consists of a number of software by other authors.
    // For example, for this project we use language tools by Apache,
    // password complexity analysis, and several others.  Each one of
    // these might have security bugs - and if they have a security
    // bug, so do we!
    //
    // DependencyCheck looks at the list of known
    // security vulnerabilities from the United States National Institute of
    // Standards and Technology (NIST), and checks if the software
    // we are importing has any major known vulnerabilities. If so,
    // the build will halt at this point.
    stage('Security: Dependency Analysis') {
      steps {
         sh './gradlew dependencyCheckAnalyze'
      }
    }

    // Run Jmeter performance testing https://jmeter.apache.org/
    // This test simulates 50 users concurrently using our software
    // for a set of common tasks.
    stage('Performance Tests') {
      steps {
         sh './gradlew runPerfTests'
      }
    }

    // Runs mutation testing against some subset of our software
    // as a spot test.  Mutation testing is where bugs are seeded
    // into the software and the tests are run, and we see which
    // tests fail and which pass, as a result.
    //
    // what *should* happen is that where code or tests are altered,
    // the test should fail, shouldn't it? However, it sometimes
    // happens that no matter how code is changed, the tests
    // continue to pass, which implies that the test wasn't really
    // providing any value for those lines.
    stage('Mutation Tests') {
      steps {
         sh './gradlew pitest'
      }
    }

    stage('Build Documentation') {
      steps {
         sh './gradlew javadoc'
      }
    }

    stage('Collect Zap Security Report') {
      steps {
        sh 'mkdir -p build/reports/zap'
        sh 'curl http://zap/OTHER/core/other/htmlreport --proxy localhost:9888 > build/reports/zap/zap_report.html'
      }
    }


    // This is the stage where we deploy to production.  If any test
    // fails, we won't get here.  Note that we aren't really doing anything - this
    // is a token step, to indicate whether we would have deployed or not.  Nothing actually
    // happens, since this is a demo project.
    stage('Deploy to Prod') {
      steps {
        // just a token operation while we pretend to deploy
        sh 'sleep 5'
      }
    }

  }

}



================================================
FILE: src/README.txt
================================================
Contents of the src directory
-----------------------------

application code directory
--------------------------
main             : Code for the application

test code directories
---------------------
bdd_test         : Tests that use Cucumber to test at the feature level
integration_test : Primarily tests that hit the database, but really any integration test
selenified_tests : Tests that use Selenified
test             : Unit tests
api_tests        : tests that target the API's
ui_tests         : tests that target the UI




For your information:

  Why do we split up the test directories this way?

  A few reasons.  I'll borrow some words from Petri Kainulainen
  (slightly modified from https://www.petrikainulainen.net/programming/maven/integration-testing-with-maven/)

    Adding integration tests to a build has traditionally been a bit painful. I suspect that the reason for
    this is that the standard directory layout has only one test directory (src/test).

    If we want to use the standard directory layout and add integration tests to our build, we have two options:

    First, we can add our integration tests to the same directory as our unit tests. This is an awful idea because
    integration tests and unit tests are totally different beasts and this approach forces us to mix them. Also, if
    we follow this approach, running unit tests from our IDE becomes a pain in the ass. When we run tests, our IDE
    runs all tests found from the test directory. This means that both unit and integration tests are run. If we
    are “lucky”, this means that our test suite is slower than it could be, but often this means that our integration
    tests fail every time. Not nice, huh?

    Second, we can add our integration tests to a new module. This is overkill because it forces us to transform our
    project into a multi-module project only because we want to separate our integration tests from our unit tests.
    Also, if our project is already a multi-module project, and we want to write integration tests for more than one
    module, we are screwed. Of course we can always create a separate integration test module for each tested module,
    but it would be less painful to shoot ourselves in the foot.

    It is pretty clear that both of these solutions suck.

    The requirements of our build are:

    - Integration and unit tests must have separate source directories. The src/integration-test/java directory
    must contain the source code of our integration tests and the src/test/java directory must contain the
    source code of our unit tests.

    - Integration and unit tests must have different resource directories. The src/integration-test/resources
    directory must contain the resources of our integration tests and the src/test/resources directory must
    contain the resources of our unit tests.

    - Only unit tests are run by default.

    - It must be possible to run only integration tests.

    - If an integration test fails, it must fail our build.

  We continue with this pattern for the BDD tests and the Selenified tests.


================================================
FILE: src/api_tests/README.txt
================================================
These files are used to drive the design of the Demo API through tests
written in Python.


================================================
FILE: src/api_tests/pytest.ini
================================================
# from https://docs.pytest.org/en/stable/deprecations.html#junit-family-default-value-change-to-xunit2

[pytest]
junit_family=xunit2

# If you discover that your tooling does not support the new format, and want to keep using the legacy version, set the option to legacy instead:

# [pytest]
# junit_family=legacy


================================================
FILE: src/api_tests/test_api.py
================================================
import requests

SERVER = "localhost"
URL = "http://%s:8080" % SERVER


# hitting this endpoint will reset the database.
def __reset_database():
    requests.get("%s/demo/flyway" % URL)


# adding a couple integers
def test_math_api_happy_path():
    r = requests.post("%s/demo/math" % URL, data={'item_a': '9', 'item_b': '7'})
    assert "16" in r.text


# does it handle negatives well?
def test_math_api_negative_numbers_integer():
    r = requests.post("%s/demo/math" % URL, data={'item_a': '-9', 'item_b': '-7'})
    assert "-16" in r.text


# Only handles integers.  Will fail with decimals.
def test_math_api_negative_numbers_float():
    r = requests.post("%s/demo/math" % URL, data={'item_a': '-9.1', 'item_b': '-7.1'})
    assert "Error: only accepts integers" in r.text


# does it handle zero well?
def test_math_api_with_zero():
    r = requests.post("%s/demo/math" % URL, data={'item_a': '9', 'item_b': '0'})
    assert "9" in r.text


# provide non-digits as input, should return an error message in the response.
def test_math_api_with_non_numeric():
    r = requests.post("%s/demo/math" % URL, data={'item_a': 'nine', 'item_b': 'seven'})
    assert "Error: only accepts integers" in r.text


# register with a good password
def test_register_api():
    __reset_database()
    r = requests.post("%s/demo/register" % URL, data={'username': 'alice', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    assert "successfully registered: true" in r.text

# register with an empty password
def test_register_api_empty_password():
    __reset_database()
    r = requests.post("%s/demo/register" % URL, data={'username': 'alice', 'password': ''})
    assert "no password provided" in r.text

# register with an empty username
def test_register_api_empty_username():
    __reset_database()
    r = requests.post("%s/demo/register" % URL, data={'username': '', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    assert "no username provided" in r.text


# register, then login
def test_login_api():
    __reset_database()
    requests.post("%s/demo/register" % URL, data={'username': 'alice', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    r = requests.post("%s/demo/login" % URL, data={'username': 'alice', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    assert "access granted" in r.text

# register, then login with empty username
def test_login_api_empty_username():
    __reset_database()
    requests.post("%s/demo/register" % URL, data={'username': 'alice', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    r = requests.post("%s/demo/login" % URL, data={'username': '', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    assert "no username provided" in r.text

# register, then login with empty password
def test_login_api_empty_password():
    __reset_database()
    requests.post("%s/demo/register" % URL, data={'username': 'alice', 'password': 'B65S3xNW8vXQHyjYnD72L3mejc'})
    r = requests.post("%s/demo/login" % URL, data={'username': 'alice', 'password': ''})
    assert "no password provided" in r.text


# test that we get the correct result if we try to register a book
def test_register_book():
    __reset_database()
    r = requests.post("%s/demo/registerbook" % URL, data={'book': 'alice in wonderland'})
    assert "SUCCESS" in r.text


# test that we get the correct result if we try to register a book that's already registered
def test_register_book_already_registered():
    __reset_database()
    requests.post("%s/demo/registerbook" % URL, data={'book': 'alice in wonderland'})
    r = requests.post("%s/demo/registerbook" % URL, data={'book': 'alice in wonderland'})
    assert "ALREADY_REGISTERED_BOOK" in r.text


# test that we get the correct result if we try to register a borrower
def test_register_borrower():
    __reset_database()
    r = requests.post("%s/demo/registerborrower" % URL, data={'borrower': 'alice'})
    assert "SUCCESS" in r.text


# test that we get the correct result if we try to register a borrower that's already registered
def test_register_borrower_already_registered():
    __reset_database()
    requests.post("%s/demo/registerborrower" % URL, data={'borrower': 'alice'})
    r = requests.post("%s/demo/registerborrower" % URL, data={'borrower': 'alice'})
    assert "ALREADY_REGISTERED_BORROWER" in r.text


# test that we can lend a book
def test_create_book_loan():
    __reset_database()
    requests.post("%s/demo/registerborrower" % URL, data={'borrower': 'alice'})
    requests.post("%s/demo/registerbook" % URL, data={'book': 'alice in wonderland'})
    r = requests.post("%s/demo/lend" % URL, data={'borrower': 'alice', 'book': 'alice in wonderland'})
    assert "SUCCESS" in r.text


# test that we get the correct result if we try to lend a book already lent.
def test_create_book_loan_already_lent():
    __reset_database()
    requests.post("%s/demo/registerborrower" % URL, data={'borrower': 'alice'})
    requests.post("%s/demo/registerbook" % URL, data={'book': 'alice in wonderland'})
    requests.post("%s/demo/lend" % URL, data={'borrower': 'alice', 'book': 'alice in wonderland'})
    r = requests.post("%s/demo/lend" % URL, data={'borrower': 'alice', 'book': 'alice in wonderland'})
    assert "BOOK_CHECKED_OUT" in r.text



================================================
FILE: src/bdd_test/README.txt
================================================
The contents of this folder provide code and documents to support a style of testing called Behavior-Driven Development (BDD).

The core aspects of this technique are:
- to use collaboration between at least the developers, testers, and business to build shared understanding
- to develop clear scenarios that help clarify user stories and better articulate the definition of done
- where possible, to consider automation for the scenarios
- builds on top of Test-Driven Development (TDD), emphasizes the essential capabilities

There are two folders here: java and resources.

Within the _resources_ directory, you will find the feature files.

In the _java_ directory, the step definitions - that is, the glue code that connects the prose in the feature
files to the actual code of the system.

Note that the different domains are separated into different directories - for example, all feature files and
step definitions related to the "library" functional domain are within the _library_ directory.


================================================
FILE: src/bdd_test/java/com/coveros/training/authentication/LoginStepDefs.java
================================================
package com.coveros.training.authentication;

import com.coveros.training.persistence.IPersistenceLayer;
import com.coveros.training.persistence.PersistenceLayer;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.junit.Assert;

public class LoginStepDefs {

    private boolean isRegisteredUser;
    private RegistrationUtils registrationUtils = RegistrationUtils.createEmpty();
    private LoginUtils loginUtils = LoginUtils.createEmpty();
    private final IPersistenceLayer pl = new PersistenceLayer();

    /**
     * create objects for registration and login, and clear the database.
     */
    private void initializeDatabaseAccess() {
        pl.cleanAndMigrateDatabase();
        registrationUtils = new RegistrationUtils();
        loginUtils = new LoginUtils();
    }

    @Given("^\"([^\"]*)\" is registered in the system with the password \"([^\"]*)\"$")
    public void isRegisteredInSystemWithPassword(String username, String password) {
        initializeDatabaseAccess();

        registrationUtils.processRegistration(username, password);
    }

    @Then("^The system decides that they are authenticated.$")
    public void theSystemDecidesThatTheyAreAuthenticated() {
        Assert.assertTrue(isRegisteredUser);
    }

    @Then("^The system decides that they are not authenticated, because .*$")
    public void theSystemDecidesThatTheyAreNotAuthenticated() {
        Assert.assertFalse(isRegisteredUser);
    }


    @When("^when a user authenticates with \"([^\"]*)\" and \"([^\"]*)\"$")
    public void whenAUserAuthenticatesWithAnd(String username, String password) {
        isRegisteredUser = loginUtils.isUserRegistered(username, password);
    }

}



================================================
FILE: src/bdd_test/java/com/coveros/training/authentication/RegistrationStepDefs.java
================================================
package com.coveros.training.authentication;

import com.coveros.training.authentication.domainobjects.PasswordResult;
import com.coveros.training.authentication.domainobjects.RegistrationResult;
import com.coveros.training.authentication.domainobjects.RegistrationStatusEnums;
import com.coveros.training.persistence.IPersistenceLayer;
import com.coveros.training.persistence.PersistenceLayer;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.junit.Assert;

import static com.coveros.training.authentication.domainobjects.PasswordResultEnums.INSUFFICIENT_ENTROPY;

public class RegistrationStepDefs {

    private static final RegistrationResult ALREADY_REGISTERED = new RegistrationResult(false, RegistrationStatusEnums.ALREADY_REGISTERED);
    private String myUsername = "";
    private RegistrationResult myRegistrationResult = RegistrationResult.createEmpty();
    private RegistrationUtils registrationUtils = RegistrationUtils.createEmpty();
    private PasswordResult passwordResult = PasswordResult.createEmpty();
    private final IPersistenceLayer pl = new PersistenceLayer();

    /**
     * create objects for registration and login, and clear the database.
     */
    private void initializeDatabaseAccess() {
        pl.cleanAndMigrateDatabase();
        registrationUtils = new RegistrationUtils();
    }

    // a password used that will suffice as a typical password
    private final static String TYPICAL_PASSWORD = "LpcVWwRkWSNVH";

    @Given("^a user \"([^\"]*)\" is not currently registered in the system$")
    public void aUserIsNotCurrentlyRegisteredInTheSystem(String username) {
        initializeDatabaseAccess();
        Assert.assertFalse(userIsRegistered(username));
        myUsername = username;
    }

    @When("^they register with that username and use the password \"([^\"]*)\"$")
    public void theyRegisterWithThatUsernameAndUseThePassword(String pw) {
        registrationUtils.processRegistration(myUsername, pw);
    }

    @Then("they become registered")
    public void they_become_registered() {
        registrationUtils.isUserInDatabase(myUsername);
    }

    private boolean userIsRegistered(String username) {
        return registrationUtils.isUserInDatabase(username);
    }

    @Given("^a username of \"([^\"]*)\" is registered$")
    public void aUsernameOfIsRegistered(String username) {
        initializeDatabaseAccess();
        registrationUtils.processRegistration(username, TYPICAL_PASSWORD);
        Assert.assertTrue(userIsRegistered(username));
        myUsername = username;
    }

    @When("a user tries to register with that same name")
    public void a_user_tries_to_register_with_that_same_name() {
        myRegistrationResult = registrationUtils.processRegistration(myUsername, TYPICAL_PASSWORD);
    }


    @Then("the system indicates a failure to register")
    public void the_system_indicates_a_failure_to_register() {
        Assert.assertEquals(ALREADY_REGISTERED, myRegistrationResult);
    }

    @When("^they enter their username and provide a poor password of (.*)$")
    public void theyEnterTheirUsernameAndProvideAPoorPassword(String password) {
        myRegistrationResult = registrationUtils.processRegistration(myUsername, password);
    }

    @Then("^they fail to register and the system indicates a response: (.*)$")
    public void theyFailToRegisterAndTheSystemIndicatesAResponse(String response) {
        Assert.assertTrue(myRegistrationResult.toString()
                .toLowerCase()
                .replace("_", " ")
                .contains(response));
    }

    @Given("^a user is in the midst of registering for an account$")
    public void aUserIsInTheMidstOfRegisteringForAnAccount() {
        // just a comment.  No state needs to be set up.
    }

    @When("^they try registering with the password (.*)$")
    public void theyTryRegisteringWithThePasswordPassword(String password) {
        passwordResult = RegistrationUtils.isPasswordGood(password);
    }

    @Then("the system returns that the password has insufficient entropy")
    public void theSystemReturnsThatThePasswordHasInsufficientEntropyTakingThisLongToCrackTime_to_crack() {
        Assert.assertEquals(INSUFFICIENT_ENTROPY, passwordResult.status);
    }
}



================================================
FILE: src/bdd_test/java/com/coveros/training/cartesianproduct/CartesianProductStepDefs.java
================================================
package com.coveros.training.cartesianproduct;

import io.cucumber.datatable.DataTable;
import io.cucumber.java.PendingException;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.junit.Assert;

import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.StringTokenizer;

public class CartesianProductStepDefs {

    Set<Set<String>> setOfSets;
    String result;

    @Given("lists as follows:")
    public void listsAsFollows(DataTable randomLists) {
        final List<String> oldLists = randomLists.asList();
        setOfSets = new HashSet<>();

        for (int i = 0; i < oldLists.size(); i++) {
            StringTokenizer defaultTokenizer = new StringTokenizer(oldLists.get(i));
            final Set<String> tempSet = new HashSet<>();
            while (defaultTokenizer.hasMoreTokens())
            {
                tempSet.add(defaultTokenizer.nextToken());
            }
            setOfSets.add(tempSet);
        }

    }

    @When("we calculate the combinations")
    public void weCalculateTheCombinations() {
        result = CartesianProduct.calculate(setOfSets);
        throw new PendingException();
    }

    @Then("the resulting combinations should be as follows:")
    public void theResultingCombinationsShouldBeAsFollows(String expectedResults) {
        Assert.assertEquals(expectedResults, result);
    }
}



================================================
FILE: src/bdd_test/java/com/coveros/training/expenses/AlcoholStepDefs.java
================================================
package com.coveros.training.expenses;

import io.cucumber.datatable.DataTable;
import io.cucumber.java.PendingException;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.junit.Assert;

import java.util.Map;

public class AlcoholStepDefs {

    private AlcoholResult alcoholResult;
    private DinnerPrices dinnerPrices;

    @Given("a dinner with the following prices in dollars:")
    public void aDinnerWithTheFollowingPricesInDollars(DataTable prices) {
        final Map<String, String> data = prices.asMaps().get(0);
        dinnerPrices = new DinnerPrices(
                Double.parseDouble(data.get("subtotal")),
                Double.parseDouble(data.get("food total")),
                Double.parseDouble(data.get("tip")),
                Double.parseDouble(data.get("tax")));

    }

    @When("I calculate the alcohol-related portion")
    public void iCalculateTheAlcoholRelatedPortion() {
        alcoholResult = AlcoholCalculator.calculate(dinnerPrices);
        throw new PendingException();
    }

    @Then("I get the following results:")
    public void iGetTheFollowingResults(DataTable expectedData) {
        final Map<String, String> data = expectedData.asMaps().get(0);
        AlcoholResult expectedResult = new AlcoholResult(
                Double.parseDouble(data.get("total food price")),
                Double.parseDouble(data.get("total alcohol price")),
                Double.parseDouble(data.get("food ratio")));
        Assert.assertEquals(alcoholResult, expectedResult);
    }
}



================================================
FILE: src/bdd_test/java/com/coveros/training/library/AddDeleteListSearchBooksAndBorrowersStepDefs.java
================================================
package com.coveros.training.library;

import com.coveros.training.library.domainobjects.Book;
import com.coveros.training.library.domainobjects.Borrower;
import com.coveros.training.library.domainobjects.LibraryActionResults;
import com.coveros.training.library.domainobjects.Loan;
import com.coveros.training.persistence.IPersistenceLayer;
import com.coveros.training.persistence.PersistenceLayer;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.junit.Assert;

import java.sql.Date;
import java.time.LocalDate;
import java.time.Month;
import java.util.ArrayList;
import java.util.List;

import static com.coveros.training.library.LibraryUtilsTests.generateListOfBooks;
import static com.coveros.training.library.LibraryUtilsTests.generateListOfBorrowers;
import static org.junit.Assert.assertEquals;

public class AddDeleteListSearchBooksAndBorrowersStepDefs {

    public static final String ALICE = "alice";
    public static final String DEVOPS_HANDBOOK = "devops handbook";
    private Book myBook = Book.createEmpty();
    private String myBookTitle = "";
    private Borrower myBorrower = Borrower.createEmpty();
    private String myBorrowerName = "";
    private final Date JAN_1ST = Date.valueOf(LocalDate.of(2018, Month.JANUARY, 1));
    private LibraryUtils libraryUtils = LibraryUtils.createEmpty();
    private final Date JAN_2ND = Date.valueOf(LocalDate.of(2018, Month.JANUARY, 2));
    private LibraryActionResults libraryActionResults = LibraryActionResults.NULL;
    private final IPersistenceLayer pl = new PersistenceLayer();
    private List<Book> allBooks = new ArrayList<>();
    private List<Borrower> allBorrowers = new ArrayList<>();

    /**
     * Set up the databases, clear them, initialize the Library Utility with them.
     */
    private void initializeEmptyDatabaseAndUtility() {
        pl.cleanAndMigrateDatabase();
        libraryUtils = new LibraryUtils();
    }

    @Given("a book, {string}, is not currently registered in the system")
    public void a_book_is_not_currently_registered_in_the_system(String bookTitle) {
        myBookTitle = bookTitle;
        initializeEmptyDatabaseAndUtility();
    }

    @When("a librarian registers that book")
    public void a_librarian_registers_that_book() {
        libraryActionResults = libraryUtils.registerBook(myBookTitle);
        myBook = libraryUtils.searchForBookByTitle(myBookTitle);
    }

    @Then("the system has the book registered")
    public void the_system_has_the_book_registered() {
        assertEquals(LibraryActionResults.SUCCESS, libraryActionResults);
        Assert.assertTrue(myBook.id > 0);
    }

    @Given("a book, {string}, is currently registered in the system")
    public void a_book_is_currently_registered_in_the_system(String bookTitle) {
        initializeEmptyDatabaseAndUtility();
        myBookTitle = bookTitle;
        libraryUtils.registerBook(bookTitle);
        myBook = libraryUtils.searchForBookByTitle(bookTitle);
    }

    @When("a librarian deletes that book")
    public void a_librarian_deletes_that_book() {
        myBook = new Book(1, myBookTitle);
        libraryActionResults = libraryUtils.deleteBook(myBook);
    }

    @Then("the system does not have the book registered")
    public void the_system_does_not_have_the_book_registered() {
        myBook = libraryUtils.searchForBookByTitle(myBook.title);
        Assert.assertTrue(myBook.isEmpty());
    }

    @Then("the system reports an error indicating that the book is already registered")
    public void the_system_reports_an_error_indicating_that_TheBookIsAlreadyRegistered() {
        assertEquals(LibraryActionResults.ALREADY_REGISTERED_BOOK, libraryActionResults);
    }


    @Then("the system reports an error indicating that the book cannot be deleted because it was never registered")
    public void theSystemReportsAnErrorIndicatingThatTheBookCannotBeDeletedBecauseItWasNeverRegistered() {
        assertEquals(LibraryActionResults.NON_REGISTERED_BOOK_CANNOT_BE_DELETED, libraryActionResults);
    }

    @Given("a borrower, {string}, is not currently registered in the system")
    public void a_borrower_is_not_currently_registered_in_the_system(String borrower) {
        myBorrowerName = borrower;
        initializeEmptyDatabaseAndUtility();
    }

    @When("a librarian registers that borrower")
    public void a_librarian_registers_that_borrower() {
        libraryActionResults = libraryUtils.registerBorrower(myBorrowerName);
    }

    @Then("the system has the borrower registered")
    public void the_system_has_the_borrower_registered() {
        final Borrower borrower = libraryUtils.searchForBorrowerByName(myBorrowerName);
        assertEquals(borrower.name, myBorrowerName);
        Assert.assertTrue(borrower.id > 0);
        assertEquals(LibraryActionResults.SUCCESS, libraryActionResults);
    }

    @Given("a borrower, {string}, is currently registered in the system")
    public void a_borrower_is_currently_registered_in_the_system(String borrowerName) {
        initializeEmptyDatabaseAndUtility();
        myBorrowerName = borrowerName;
        libraryActionResults = libraryUtils.registerBorrower(borrowerName);
    }

    @When("a librarian deletes that borrower")
    public void a_librarian_deletes_that_borrower() {
        final Borrower borrower = new Borrower(1, myBorrowerName);
        libraryActionResults = libraryUtils.deleteBorrower(borrower);
    }

    @Then("the system does not have the borrower registered")
    public void the_system_does_not_have_the_borrower_registered() {
        final Borrower borrower = libraryUtils.searchForBorrowerByName(myBorrowerName);
        Assert.assertTrue(borrower.isEmpty());
    }

    @Given("a library with the following books registered: a, b, c")
    public void a_library_with_the_following_books_registered() {
        initializeEmptyDatabaseAndUtility();
        libraryUtils.registerBook("a");
        libraryUtils.registerBook("b");
        libraryUtils.registerBook("c");
    }

    @When("a librarian lists all the registered books")
    public void a_librarian_lists_all_the_registered_books() {
        allBooks = libraryUtils.listAllBooks();
    }

    @Then("the whole list of books is returned")
    public void the_whole_list_of_books_is_returned() {
        final List<Book> expectedBooks = generateListOfBooks(new String[]{"a", "b", "c"});
        assertEquals(expectedBooks, allBooks);
    }

    @Then("the whole list of borrowers is returned")
    public void the_whole_list_of_borrowers_is_returned() {
        final List<Borrower> expectedBorrowers = generateListOfBorrowers(new String[]{"a", "b", "c"});
        assertEquals(expectedBorrowers, allBorrowers);
    }

    @When("a librarian searches by that title")
    public void a_librarian_searches_by_that_title() {
        myBook = libraryUtils.searchForBookByTitle(myBookTitle);
    }

    @Then("the system returns the book's full data")
    public void the_system_returns_the_books_full_data() {
        assertEquals(myBookTitle, myBook.title);
        Assert.assertTrue(myBook.id > 0);
    }

    @Then("the system returns the borrower's full data")
    public void the_system_returns_the_borrowers_full_data() {
        assertEquals(myBorrowerName, myBorrower.name);
        Assert.assertTrue(myBorrower.id > 0);
    }

    @When("a librarian searches by its id")
    public void a_librarian_searches_by_its_id() {
        myBook = libraryUtils.searchForBookById(myBook.id);
    }

    @Given("no books are registered in the system")
    public void no_books_are_registered_in_the_system() {
        initializeEmptyDatabaseAndUtility();
    }

    @When("a librarian searches for a book by id {int}")
    public void a_librarian_searches_for_a_book_by_id(Integer bookId) {
        myBook = libraryUtils.searchForBookById(bookId);
    }

    @Then("the system returns an empty result for the book")
    public void the_system_returns_an_empty_result_for_the_book() {
        Assert.assertTrue(myBook.isEmpty());
    }

    @Then("the system returns an empty result for the borrower")
    public void the_system_returns_an_empty_result_for_the_borrower() {
        Assert.assertTrue(myBorrower.isEmpty());
    }

    @When("a librarian searches for a book by title of {string}")
    public void a_librarian_searches_for_a_book_by_title_of(String bookTitle) {
        myBook = libraryUtils.searchForBookByTitle(bookTitle);
    }

    @Then("the system reports that there are no books in the system")
    public void the_system_reports_that_there_are_no_books_in_the_system() {
        Assert.assertTrue(allBooks.isEmpty());
    }

    @Given("a library with the following borrowers registered: a, b, c")
    public void a_library_with_the_following_borrowers_registered() {
        initializeEmptyDatabaseAndUtility();
        libraryUtils.registerBorrower("a");
        libraryUtils.registerBorrower("b");
        libraryUtils.registerBorrower("c");
    }

    @When("a librarian lists all the registered borrowers")
    public void a_librarian_lists_all_the_registered_borrowers() {
        allBorrowers = libraryUtils.listAllBorrowers();
    }

    @When("a librarian searches by that name")
    public void a_librarian_searches_by_that_name() {
        myBorrower = libraryUtils.searchForBorrowerByName(myBorrowerName);
    }

    @Given("no borrowers are registered in the system")
    public void no_borrowers_are_registered_in_the_system() {
        initializeEmptyDatabaseAndUtility();
    }

    @When("a librarian searches for a borrower by id {int}")
    public void a_librarian_searches_for_a_borrower_by_id(Integer id) {
        myBorrower = libraryUtils.searchForBorrowerById(id);
    }

    @Then("the system reports that there are no borrowers with that id")
    public void the_system_reports_that_there_are_no_borrowers_with_that_id() {
        Assert.assertTrue(myBorrower.isEmpty());
    }

    @When("a librarian searches for a borrower by name of {string}")
    public void a_librarian_searches_for_a_borrower_by_name_of(String name) {
        myBorrower = libraryUtils.searchForBorrowerByName(name);
    }

    @Then("the system reports that there are no borrowers found with that name")
    public void the_system_reports_that_there_are_no_borrowers_found_with_that_name() {
        Assert.assertTrue(myBorrower.isEmpty());
    }

    @When("a librarian lists all the borrowers")
    public void a_librarian_lists_all_the_borrowers() {
        allBorrowers = libraryUtils.listAllBorrowers();
    }

    @Then("the system returns an empty list of borrowers")
    public void the_system_returns_an_empty_list_of_borrowers() {
        Assert.assertTrue(allBorrowers.isEmpty());
    }

    @Then("the system reports an error indicating that the borrower is already registered")
    public void the_system_reports_an_error_indicating_that_the_borrower_is_already_registered() {
        assertEquals(LibraryActionResults.ALREADY_REGISTERED_BORROWER, libraryActionResults);
    }

    @Then("the system reports an error indicating that the borrower cannot be deleted because he or she was never registered")
    public void the_system_reports_an_error_indicating_that_the_borrower_cannot_be_deleted_because_he_or_she_was_never_registered() {
        assertEquals(LibraryActionResults.NON_REGISTERED_BORROWER_CANNOT_BE_DELETED, libraryActionResults);
    }

    @When("a librarian searches by that id")
    public void a_librarian_searches_by_that_id() {
        final Borrower tempBorrower = libraryUtils.searchForBorrowerByName(myBorrowerName);
        myBorrower = libraryUtils.searchForBorrowerById(tempBorrower.id);
    }

    @Given("a book, {string}, is currently loaned out")
    public void aBookIsCurrentlyLoanedOut(String bookTitle) {
        initializeEmptyDatabaseAndUtility();
        libraryUtils.registerBorrower(ALICE);
        libraryUtils.registerBook(bookTitle);
        myBookTitle = bookTitle;
        libraryUtils.lendBook(bookTitle, ALICE, JAN_1ST);
    }

    @Given("a book is currently loaned out to {string}")
    public void aBookIsCurrentlyLoanedOutTo(String borrowerName) {
        initializeEmptyDatabaseAndUtility();
        libraryUtils.registerBorrower(borrowerName);
        myBorrowerName = borrowerName;
        libraryUtils.registerBook(DEVOPS_HANDBOOK);
        libraryUtils.lendBook(DEVOPS_HANDBOOK, borrowerName, JAN_1ST);
    }

    @Given("a book is loaned to {string}")
    public void aBookIsLoanedTo(String borrowerName) {
        myBorrowerName = borrowerName;
        initializeEmptyDatabaseAndUtility();
        libraryUtils.registerBook(DEVOPS_HANDBOOK);
        libraryUtils.registerBorrower(borrowerName);
        libraryUtils.lendBook(DEVOPS_HANDBOOK, borrowerName, JAN_2ND);
        myBook = libraryUtils.searchForBookByTitle(DEVOPS_HANDBOOK);
    }

    @Then("the loan is deleted as well")
    public void theLoanIsDeletedAsWell() {
        final Loan loan = libraryUtils.searchForLoanByBook(myBook);
        Assert.assertTrue(loan.isEmpty());
    }

    @Given("a book, {string}, is loaned out")
    public void aBookIsLoanedOut(String bookTitle) {
        initializeEmptyDatabaseAndUtility();
        myBookTitle = bookTitle;
        libraryUtils.registerBook(myBookTitle);
        libraryUtils.registerBorrower(ALICE);
        libraryUtils.lendBook(bookTitle, ALICE, JAN_1ST);
    }

    @Given("some books are checked out")
    public void some_books_are_checked_out() {
        initializeEmptyDatabaseAndUtility();
        // register a, b, and c
        libraryUtils.registerBook("a");
        libraryUtils.registerBook("b");
        libraryUtils.registerBook("c");
        libraryUtils.registerBorrower("someone");

        // loan out b
        libraryUtils.lendBook("b", "someone", JAN_1ST);
    }

    @When("a librarian lists the available books")
    public void a_librarian_lists_the_available_books() {
        allBooks = libraryUtils.listAvailableBooks();
    }

    @Then("the system responds with only the available books")
    public void the_system_responds_with_only_the_available_books() {
        List<Book> expectedBooks = new ArrayList<>();
        expectedBooks.add(new Book(1, "a"));
        expectedBooks.add(new Book(3, "c"));
        assertEquals(expectedBooks, allBooks);
    }
}



================================================
FILE: src/bdd_test/java/com/coveros/training/library/BookCheckOutStepDefs.java
================================================
package com.coveros.training.library;

import com.coveros.training.library.domainobjects.Book;
import com.coveros.training.library.domainobjects.Borrower;
import com.coveros.training.library.domainobjects.LibraryActionResults;
import com.coveros.training.library.domainobjects.Loan;
import com.coveros.training.persistence.IPersistenceLayer;
import com.coveros.training.persistence.PersistenceLayer;
import io.cucumber.java.en.And;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import org.junit.Assert;

import java.sql.Date;
import java.time.LocalDate;
import java.time.Month;
import java.time.format.DateTimeFormatter;
import java.util.List;

public class BookCheckOutStepDefs {

    public static final String ANOTHER_BOOK = "another book";
    private Book myBook = Book.createEmpty();
    private String myBookTitle = "";
    private String myBorrowerName = "";
    private Borrower myBorrower = Borrower.createEmpty();
    private final Date JAN_1ST = Date.valueOf(LocalDate.of(2018, Month.JANUARY, 1));
    private LibraryUtils libraryUtils = LibraryUtils.createEmpty();
    private final Date JAN_2ND = Date.valueOf(LocalDate.of(2018, Month.JANUARY, 2));
    private LibraryActionResults libraryActionResults = LibraryActionResults.NULL;
    private final IPersistenceLayer pl = new PersistenceLayer();

    /**
     * Set up the databases, clear them, initialize the Library Utility with them.
     */
    private void initializeEmptyDatabaseAndUtility() {
        pl.cleanAndMigrateDatabase();
        libraryUtils = new LibraryUtils();
    }

    @Given("^a borrower, \"([^\"]*)\", is registered$")
    public void aBorrowerIsRegistered(String borrowerName) {
        initializeEmptyDatabaseAndUtility();

        libraryUtils.registerBorrower(borrowerName);
        myBorrower = libraryUtils.searchForBorrowerByName(borrowerName);
    }

    @And("^a book, \"([^\"]*)\" is available for borrowing$")
    public void aBookIsAvailableForBorrowing(String title) {
        libraryUtils.registerBook(title);
        myBook = libraryUtils.searchForBookByTitle(title);
    }

    @When("^they try to check out the book on \"([^\"]*)\"$")
    public void theyTryToCheckOutTheBookOn(String date) {
        Date borrowTime = Date.valueOf(LocalDate.parse(date, DateTimeFormatter.ofPattern("MMMM dd, yyyy")));
        libraryUtils.lendBook(myBook, myBorrower, borrowTime);
    }

    @Then("^the system indicates the book is loaned to them on that date$")
    public void theSystemIndicatesTheBookIsLoanedToThemOnThatDate() {
        final Loan loan = libraryUtils.searchForLoanByBook(myBook);
        Assert.assertEquals(Date.valueOf("2018-01-31"), loan.checkoutDate);
    }

    @When("^they try to check out the book$")
    public void theyCheckOutTheBook() {
        libraryUtils.lendBook(myBook, myBorrower, JAN_2ND);
    }

    @Then("^the system indicates the book is loaned to them on some date$")
    public void theSystemIndicatesTheBookIsLoanedToThemOnSomeDate() {
        final Loan loan = libraryUtils.searchForLoanByBook(myBook);
        Assert.assertEquals(Date.valueOf("2018-01-31"), loan.checkoutDate);
    }

    @Given("^an individual, \"([^\"]*)\", is not registered$")
    public void anIndividualIsNotRegistered(String borrower) {
        initializeEmptyDatabaseAndUtility();
    }

    @When("^they try to check out a book, \"([^\"]*)\" that is available$")
    public void theyTryToCheckOutABookThatIsAvailable(String title) {
        libraryUtils.registerBook(title);
        myBook = libraryUtils.searchForBookByTitle(title);

        libraryActionResults = libraryUtils.lendBook(myBook, myBorrower, JAN_2ND);
    }

    @Then("^the system indicates that they are not registered$")
    public void theSystemIndicatesThatHeIsNotRegistered() {
        Assert.assertEquals(LibraryActionResults.BORROWER_NOT_REGISTERED, libraryActionResults);
    }

    @Given("^and a book, \"([^\"]*)\" is already checked out to \"([^\"]*)\"$")
    public void andABookIsAlreadyCheckedOutTo(String title, String borrower_b) {
        libraryUtils.registerBorrower(borrower_b);
        libraryUtils.registerBook(title);
        final Book book = libraryUtils.searchForBookByTitle(title);
        final Borrower borrower = libraryUtils.searchForBorrowerByName(borrower_b);

        // a previous person already checked it out.
        libraryUtils.lendBook(book, borrower, JAN_1ST);

        // now we try to check it out.  It should indicate BOOK_CHECKED_OUT.
        libraryActionResults = libraryUtils.lendBook(book, myBorrower, JAN_2ND);
    }

    @Then("^the system indicates that the book is not available$")
    public void theSystemIndicatesThatTheBookIsNotAvailable() {
        Assert.assertEquals(LibraryActionResults.BOOK_CHECKED_OUT, libraryActionResults);
    }

    @Given("a borrower, {string}, has one book, {string}, already borrowed")
    public void a_borrower_has_one_book_already_borrowed(String borrowerName, String bookTitle) {
        initializeEmptyDatabaseAndUtility();
        myBookTitle = bookTitle;
        myBorrowerName = borrowerName;
        libraryUtils.registerBook(myBookTitle);
        libraryUtils.registerBorrower(borrowerName);
        libraryUtils.lendBook(bookTitle, borrowerName, JAN_1ST);
    }

    @When("they borrow another book")
    public void they_borrow_another_book() {
        libraryUtils.registerBook(ANOTHER_BOOK);
        libraryUtils.lendBook(ANOTHER_BOOK, myBorrowerName, JAN_1ST);
    }

    @Then("they have two books currently borrowed")
    public void they_have_two_books_currently_borrowed() {
        final Borrower borrower = libraryUtils.searchForBorrowerByName(myBorrowerName);
        final List<Loan> loans = libraryUtils.searchForLoanByBorrower(borrower);
        Assert.assertEquals(2, loans.size());
    }

    @When("another borrower, {string} tries to borrow that book")
    public void another_borrower_tries_to_borrow_that_book(String string) {
        libraryUtils.registerBorrower("someone else");
        libraryActionResults = libraryUtils.lendBook(myBookTitle, "someone else", JAN_1ST);
    }

    @Then("they cannot borrow it because it is already checked out")
    public void they_cannot_borrow_it_because_it_is_already_checked_out() {
        Assert.assertEquals(LibraryActionResults.BOOK_CHECKED_OUT, libraryActionResults);
    }


}